<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dali Nadjib AI Voiture â€” ØªØ´Ø®ÙŠØµ Ø£ÙƒÙˆØ§Ø¯ OBD</title>
  <style>
    :root{
      --bg:#0b0c10;
      --card:#0f1720;
      --muted:#9aa4b2;
      --accent1:#ff6b6b;
      --accent2:#7c5cff;
      --accent3:#00d4ff;
      --glass: rgba(255,255,255,0.04);
      --success:#4ade80;
      --danger:#ff7b7b;
      --radius:14px;
    }
    *{box-sizing:border-box;font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Arial; }
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 10% 20%, rgba(124,92,255,0.10), transparent 8%),
                  radial-gradient(900px 400px at 90% 80%, rgba(0,212,255,0.06), transparent 8%),
                  var(--bg);
      color:#e6eef8;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:28px;
      min-height:100vh;
    }
    .app{
      max-width:1100px;
      margin:0 auto;
      display:grid;
      grid-template-columns: 420px 1fr;
      gap:20px;
      align-items:start;
    }

    /* SIDEBAR / FORM */
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid rgba(255,255,255,0.04);
      padding:20px;
      border-radius: var(--radius);
      box-shadow: 0 6px 30px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    }
    h1{
      margin:0 0 8px 0;
      font-size:20px;
      letter-spacing:0.2px;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .title-badge{
      background:linear-gradient(90deg,var(--accent2),var(--accent3));
      padding:8px 12px;
      border-radius:10px;
      font-weight:700;
      font-size:13px;
      color:#020617;
    }
    p.lead{ margin:8px 0 18px 0; color:var(--muted); font-size:13px; }

    label{ display:block; font-size:13px; color:var(--muted); margin-top:12px; margin-bottom:6px; }
    input[type="text"], select, textarea {
      width:100%;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.04);
      background:var(--glass);
      color:inherit;
      outline:none;
      font-size:14px;
      resize:vertical;
    }
    textarea{ min-height:86px; }
    .row{ display:flex; gap:10px; }
    .btn{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 14px; border-radius:12px; cursor:pointer;
      border: none; font-weight:700; font-size:14px;
    }
    .btn-primary{
      background: linear-gradient(90deg,var(--accent2),var(--accent1));
      color:#07070b;
      box-shadow: 0 8px 28px rgba(124,92,255,0.12);
    }
    .btn-ghost{
      background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--muted);
    }
    .small { font-size:12px; color:var(--muted); margin-top:8px; }

    /* MAIN OUTPUTS */
    .outputs{
      display:flex; flex-direction:column; gap:16px;
    }
    .panel{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.04);
      padding:18px; border-radius:14px;
    }
    .badge{
      display:inline-flex; gap:8px; align-items:center;
      padding:6px 10px; border-radius:999px; font-size:13px; color:#071122;
      background:linear-gradient(90deg,var(--accent3),var(--accent2)); font-weight:700;
    }
    .meta{ display:flex; gap:10px; align-items:center; color:var(--muted); font-size:13px; margin-bottom:8px; flex-wrap:wrap; }

    .fault{
      border-radius:12px; padding:12px; margin-bottom:10px;
      background: linear-gradient(90deg, rgba(124,92,255,0.06), rgba(0,212,255,0.02));
      border:1px solid rgba(124,92,255,0.08);
    }
    .analysis{
      background: linear-gradient(90deg, rgba(0,0,0,0.12), rgba(255,255,255,0.01));
      padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,0.02);
    }
    ul{ margin:8px 0 0 0; padding-left:18px; color:#dbe8ff; }
    li{ margin:6px 0; color:#dbe8ff; }

    footer.appfoot{ text-align:center; color:var(--muted); margin-top:18px; grid-column:1/-1; }

    /* responsive */
    @media (max-width:980px){
      .app{ grid-template-columns:1fr; padding:16px; }
    }

    /* little icons */
    .icon {
      width:22px;height:22px;display:inline-block;
    }

    /* empty state */
    .empty { text-align:center; color:var(--muted); padding:28px; border-radius:12px; border:1px dashed rgba(255,255,255,0.03); }

    /* result header */
    .res-head{ display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; }
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Dali Nadjib AI Voiture">
    <!-- LEFT FORM -->
    <aside class="card" aria-labelledby="app-title">
      <h1 id="app-title"><span class="title-badge">Dali Nadjib AI</span> ØªØ´Ø®ÙŠØµ Ø£Ø¹Ø·Ø§Ù„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</h1>
      <p class="lead">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙˆÙƒÙˆØ¯ OBD Ø£Ùˆ ÙˆØµÙ Ø§Ù„Ø­Ø§Ù„Ø©ØŒ ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø£Ø¹Ø·Ø§Ù„ Ù…Ø­ØªÙ…Ù„Ø©ØŒ ØªØ­Ù„ÙŠÙ„ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©ØŒ ÙˆØ­Ù„ÙˆÙ„ Ù…ÙØµÙ‘Ù„Ø©.</p>

      <label for="brand">Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© / Ø§Ù„Ù…Ø§Ø±ÙƒØ©</label>
      <select id="brand" aria-label="Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©">
        <option value="all">Ø¹Ø§Ù… â€” ØºÙŠØ± Ù…Ø­Ø¯Ø¯</option>
        <option>Renault</option>
        <option>Peugeot</option>
        <option>Toyota</option>
        <option>Hyundai</option>
        <option>Mercedes</option>
        <option>Volkswagen</option>
        <option>BMW</option>
        <option>Other</option>
      </select>

      <div style="display:flex;gap:10px;">
        <div style="flex:1">
          <label for="model">Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</label>
          <input id="model" type="text" placeholder="Ù…Ø«Ø§Ù„: Clio, 208, Corolla..." />
        </div>
        <div style="width:120px;">
          <label for="year">Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹</label>
          <input id="year" type="text" placeholder="Ù…Ø«Ø§Ù„: 2015" />
        </div>
      </div>

      <label for="code">ÙƒÙˆØ¯ OBD (Ù…Ø«Ø§Ù„: P0300)</label>
      <input id="code" type="text" placeholder="P0300" />

      <label for="desc">ÙˆØµÙ Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø© (Ø¨Ø¥ÙŠØ¬Ø§Ø²)</label>
      <textarea id="desc" placeholder="Ø£ÙƒØªØ¨ Ù‡Ù†Ø§: Ù…Ø«Ù„Ø§Ù‹ 'Ø§Ù„Ù…Ø­Ø±Ùƒ ÙŠÙ‡ØªØ² Ø¹Ù†Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„ØŒ Ø¶ÙˆØ¡ Ø§Ù„Ù…Ø­Ø±Ùƒ Ù…Ø¶ÙŠØ¡'"></textarea>

      <div style="display:flex;gap:10px;margin-top:14px;">
        <button class="btn btn-primary" id="analyzeBtn" title="ØªØ´Ø®ÙŠØµ">ğŸ” ØªØ´Ø®ÙŠØµ Ø§Ù„Ø¢Ù†</button>
        <button class="btn btn-ghost" id="resetBtn" title="Ù…Ø³Ø­">â™»ï¸ Ù…Ø³Ø­</button>
      </div>

      <div class="small">Ù†Ù‚Ø·Ø© Ù…Ù‡Ù…Ø©: Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù„Ù. ÙÙŠ Ø­Ø§Ù„ Ù„Ù… ÙŠØ¸Ù‡Ø± Ø§Ù„ÙƒÙˆØ¯ØŒ Ø¬Ø±Ù‘Ø¨ ÙƒØªØ§Ø¨Ø© Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø¯Ù‚Ø© Ø£Ùˆ ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø¨ÙƒÙ„Ù…Ø§Øª Ø¹Ø±Ø¨ÙŠØ© Ø¨Ø³ÙŠØ·Ø©.</div>
    </aside>

    <!-- RIGHT OUTPUTS -->
    <main class="outputs">
      <section class="panel" id="resultPanel">
        <div class="res-head">
          <div style="display:flex;gap:12px;align-items:center;">
            <div class="badge">Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ´Ø®ÙŠØµ</div>
            <div class="meta" id="metaInfo">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªÙŠØ¬Ø© â€” Ø§Ø¶ØºØ· "ØªØ´Ø®ÙŠØµ Ø§Ù„Ø¢Ù†".</div>
          </div>
          <div style="display:flex;gap:8px;">
            <button class="btn btn-ghost" id="exportBtn" title="ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙƒÙ€ JSON">ğŸ“¤ ØªØµØ¯ÙŠØ±</button>
            <button class="btn btn-ghost" id="copyBtn" title="Ù†Ø³Ø® Ù…Ù„Ø®Øµ">ğŸ“‹ Ù†Ø³Ø®</button>
          </div>
        </div>

        <div id="outputArea" style="margin-top:14px;">
          <div class="empty">
            <div style="font-size:18px; font-weight:700; margin-bottom:6px">Ù„Ù… ÙŠØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ ØªØ´Ø®ÙŠØµ Ø¨Ø¹Ø¯</div>
            <div>Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ OBD Ø£Ùˆ ÙˆØµÙ Ø§Ù„Ø­Ø§Ù„Ø© Ø«Ù… Ø§Ø¶ØºØ· "ØªØ´Ø®ÙŠØµ Ø§Ù„Ø¢Ù†".</div>
          </div>
        </div>
      </section>

      <section class="panel">
        <h3 style="margin:0 0 8px 0;">Ù‚ÙˆØ§Ø¹Ø¯ Ø³Ø±ÙŠØ¹Ø© / Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h3>
        <ul>
          <li>Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø¹Ø§Ù…Ø© (P0xxx) ØªØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ù…Ø¹Ø¸Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª. Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ P1xxx Ù‚Ø¯ ØªÙƒÙˆÙ† Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø´Ø±ÙƒØ©.</li>
          <li>Ø¥Ø°Ø§ Ù„Ù… ØªØ¬Ø¯ Ø§Ù„ÙƒÙˆØ¯: Ø£Ø¯Ø®Ù„Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø«Ù… ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙ‡Ø¬Ø¦ØªÙ‡ØŒ Ø£Ùˆ Ø§ÙƒØªØ¨ ÙˆØµÙ Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ³ÙŠØ­Ø§ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©.</li>
          <li>Ù‡Ø°Ù‡ Ù†Ø³Ø®Ø© ØªØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠÙ‹Ø§ â€” ÙŠÙ…ÙƒÙ† Ø±ÙØ¹ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª JSON Ø£ÙƒØ¨Ø± Ù„Ø§Ø­Ù‚Ù‹Ø§.</li>
        </ul>
      </section>

      <footer class="appfoot">Â© <strong>Dali Nadjib AI Voiture</strong> â€” ÙˆØ§Ø¬Ù‡Ø© ØªØ´Ø®ÙŠØµ OBD Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</footer>
    </main>
  </div>

  <script>
    // Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¨Ø³Ø·Ø© â€” ÙŠÙ…ÙƒÙ†Ùƒ ØªÙˆØ³ÙŠØ¹Ù‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø£Ùˆ Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON ÙƒØ¨ÙŠØ±
    const DB = [
      {
        code:"P0300",
        title:"Ø®Ù„Ù„ Ø§Ø­ØªØ±Ø§Ù‚ Ø¹Ø´ÙˆØ§Ø¦ÙŠ (Misfire)",
        brands:["all"],
        system:"Ù…Ø­Ø±Ùƒ",
        description:"Ø§Ù‡ØªØ²Ø§Ø² ÙÙŠ Ø§Ù„Ù…Ø­Ø±Ùƒ Ø£Ùˆ ÙÙ‚Ø¯Ø§Ù† Ù‚ÙˆØ© Ø¨Ø³Ø¨Ø¨ Ø§Ø­ØªØ±Ø§Ù‚ ØºÙŠØ± Ù…Ù†ØªØ¸Ù… ÙÙŠ Ø£Ø³Ø·ÙˆØ§Ù†Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©.",
        causes:["Ø´Ù…Ø¹Ø§Øª Ø§Ø­ØªØ±Ø§Ù‚ ØªØ§Ù„ÙØ©","ÙƒÙˆÙŠÙ„Ø§Øª Ø§Ø´ØªØ¹Ø§Ù„ Ù…Ø¹Ø·ÙˆØ¨Ø©","Ø¨Ø®Ø§Ø®Ø§Øª Ù…ØªØ³Ø®Ø© Ø£Ùˆ Ù…Ø³Ø¯ÙˆØ¯Ø©","ØªØ³Ø±ÙŠØ¨ Ù‡ÙˆØ§Ø¡ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…","Ø¶ØºØ· Ø§Ø³Ø·ÙˆØ§Ù†Ø§Øª Ù…Ù†Ø®ÙØ¶"],
        solutions:["ÙØ­Øµ ÙˆØªØºÙŠÙŠØ± Ø´Ù…Ø¹Ø§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§Ù‚","Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙƒÙˆÙŠÙ„Ø§Øª ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…Ø¹Ø·ÙˆØ¨Ø©","ØªÙ†Ø¸ÙŠÙ Ø£Ùˆ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¨Ø®Ø§Ø®Ø§Øª","ÙØ­Øµ ØªØ³Ø±ÙŠØ¨Ø§Øª Ø§Ù„Ù‡ÙˆØ§Ø¡ ÙˆØ®Ø±Ø§Ø·ÙŠÙ… Ø§Ù„Ø³Ø­Ø¨","Ù‚ÙŠØ§Ø³ Ø¶ØºØ· Ø§Ù„Ø§Ø³Ø·ÙˆØ§Ù†Ø§Øª"]
      },
      {
        code:"P0171",
        title:"Ø®Ù„ÙŠØ· ÙÙ‚ÙŠØ± - Ø¨Ù†Ùƒ 1 (Lean)",
        brands:["all"],
        system:"ÙˆÙ‚ÙˆØ¯ / Ù‡ÙˆØ§Ø¡",
        description:"Ø§Ù„ÙˆØ­Ø¯Ø© ØªØªØ­Ø³Ø³ Ø®Ù„ÙŠØ· Ù‡ÙˆØ§Ø¡/ÙˆÙ‚ÙˆØ¯ ÙÙ‚ÙŠØ± ÙÙŠ Ø§Ù„Ø¬Ø§Ù†Ø¨ 1.",
        causes:["ØªØ³Ø±ÙŠØ¨ Ù‡ÙˆØ§Ø¡ Ø¨Ø¹Ø¯ MAF","Ø­Ø³Ø§Ø³ MAF Ù…Ø¹Ø·ÙˆØ¨ Ø£Ùˆ Ù…ØªØ³Ø®","Ø¶ØºØ· ÙˆÙ‚ÙˆØ¯ Ù…Ù†Ø®ÙØ¶","Ø§Ù†Ø³Ø¯Ø§Ø¯ ÙÙ„ØªØ± Ø§Ù„ÙˆÙ‚ÙˆØ¯"],
        solutions:["ØªÙ†Ø¸ÙŠÙ/Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø­Ø³Ø§Ø³ MAF","ÙØ­Øµ Ø¶ØºØ· Ù…Ø¶Ø®Ø© Ø§Ù„ÙˆÙ‚ÙˆØ¯","Ø§Ø³ØªØ¨Ø¯Ø§Ù„ ÙÙ„ØªØ± Ø§Ù„ÙˆÙ‚ÙˆØ¯","ÙØ­Øµ Ø®Ø±Ø§Ø·ÙŠÙ… Ø§Ù„ØªØ³Ø±ÙŠØ¨"]
      },
      {
        code:"P0420",
        title:"ÙƒÙØ§Ø¡Ø© Ø§Ù„Ù…Ø­ÙˆÙ„ Ø§Ù„Ø­ÙØ§Ø² Ù…Ù†Ø®ÙØ¶Ø©",
        brands:["all"],
        system:"Ø¹Ø§Ø¯Ù…",
        description:"Ø§Ù†Ø®ÙØ§Ø¶ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø­ÙˆÙ„ Ø§Ù„Ø­ÙØ§Ø² (Catalytic converter) Ù…Ù…Ø§ ÙŠØ²ÙŠØ¯ Ø§Ù†Ø¨Ø¹Ø§Ø«Ø§Øª Ø§Ù„Ø¹Ø§Ø¯Ù….",
        causes:["ØªØ´Ø¨Ø¹ Ø£Ùˆ ØªÙ„Ù Ø§Ù„Ù…Ø­ÙˆÙ„ Ø§Ù„Ø­ÙØ§Ø²","Ø­Ø³Ø§Ø³ Ø£ÙƒØ³Ø¬ÙŠÙ† Ù…Ø¹Ø·ÙˆØ¨","Ø­Ø±Ù‚ ØºÙŠØ± Ù…ÙƒØªÙ…Ù„ Ù„ÙØªØ±Ø© Ø·ÙˆÙŠÙ„Ø©","ØªØ³Ø±ÙŠØ¨ Ø¹Ø§Ø¯Ù…"],
        solutions:["ÙØ­Øµ Ø­Ø³Ø§Ø³Ø§Øª O2 ÙˆØ£Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø¶Ø±ÙˆØ±Ø©","ÙØ­Øµ Ø§Ù„Ù…Ø­ÙˆÙ„ Ùˆ Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ Ø¥Ø°Ø§ Ù„Ø²Ù…","Ø¥ØµÙ„Ø§Ø­ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø§Ø­ØªØ±Ø§Ù‚"]
      },
      {
        code:"P0101",
        title:"Ø¥Ø´Ø§Ø±Ø© Ø­Ø³Ø§Ø³ ØªØ¯ÙÙ‚ Ø§Ù„Ù‡ÙˆØ§Ø¡ (MAF) ØºÙŠØ± Ø·Ø¨ÙŠØ¹ÙŠØ©",
        brands:["all"],
        system:"Ø­Ø³Ø§Ø³Ø§Øª",
        description:"Ù‚Ø±Ø§Ø¡Ø§Øª ØºÙŠØ± Ù…Ù†Ø·Ù‚ÙŠØ© Ù…Ù† Ø­Ø³Ø§Ø³ MAF Ù…Ù‚Ø§Ø±Ù†Ø©Ù‹ Ø¨Ø´Ø±Ø· Ø§Ù„Ø­Ù…Ù„.",
        causes:["Ø­Ø³Ø§Ø³ MAF Ù…ØªØ³Ø®","ØªÙˆØµÙŠÙ„Ø§Øª ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© Ø³ÙŠØ¦Ø©","Ø­Ø³Ø§Ø³ Ù…Ø¹Ø·Ù„"],
        solutions:["ØªÙ†Ø¸ÙŠÙ Ø­Ø³Ø§Ø³ MAF","ÙØ­Øµ Ø§Ù„ØªÙˆØµÙŠÙ„Ø§Øª ÙˆØ§Ù„Ø£Ø³Ù„Ø§Ùƒ","Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø­Ø³Ø§Ø³ Ø¥Ø°Ø§ ØªØ£ÙƒØ¯ Ø§Ù„Ø¹Ø·Ù„"]
      },
      {
        code:"P0113",
        title:"Ø­Ø³Ø§Ø³ Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù‡ÙˆØ§Ø¡ (IAT) Ø¥Ø´Ø§Ø±Ø© Ø¹Ø§Ù„ÙŠØ©",
        brands:["all"],
        system:"Ø­Ø³Ø§Ø³Ø§Øª",
        description:"Ø§Ù„Ø¥Ø´Ø§Ø±Ø© ØªØ´ÙŠØ± Ø¥Ù„Ù‰ Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ù‡ÙˆØ§Ø¡ Ù…Ø±ØªÙØ¹Ø© Ø£Ùˆ Ù…Ù‚Ø·ÙˆØ¹Ø© Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©.",
        causes:["Ø­Ø³Ø§Ø³ IAT Ù…Ø¹Ø·ÙˆØ¨","Ø£Ø³Ù„Ø§Ùƒ Ù…Ù‚Ø·ÙˆØ¹Ø© Ø£Ùˆ Ù…Ù‚Ø·ÙˆØ¹Ø©","Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø³Ø§Ø³ Ø®Ø§Ø·Ø¦"],
        solutions:["ÙØ­Øµ Ø§Ù„Ø­Ø³Ø§Ø³ ÙˆØ§Ù„Ø£Ø³Ù„Ø§Ùƒ","Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø­Ø³Ø§Ø³ Ø¥Ø°Ø§ Ù„Ø²Ù…"]
      },
      {
        code:"P0128",
        title:"Ø­Ø±Ø§Ø±Ø© Ø§Ù„ØªØ¨Ø±ÙŠØ¯ Ù„Ù… ØªØµÙ„ Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„ØªØ´ØºÙŠÙ„",
        brands:["all"],
        system:"ØªØ¨Ø±ÙŠØ¯",
        description:"Ø§Ù„Ø«Ø±Ù…ÙˆØ³ØªØ§Øª Ø¹Ø§Ù„Ù‚ Ù…ÙØªÙˆØ­Ù‹Ø§ Ø£Ùˆ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¯ÙØ¦Ø©/Ø§Ù„Ù…Ø¨Ø±Ø¯ Ù„Ø§ ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.",
        causes:["Ø«Ø±Ù…ÙˆØ³ØªØ§Øª Ù…Ø¹Ø·ÙˆØ¨","Ù…Ø³ØªØ´Ø¹Ø± Ø­Ø±Ø§Ø±Ø© Ù…Ø¹Ø·Ù„","Ù†Ù‚Øµ ÙÙŠ Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØ¨Ø±ÙŠØ¯"],
        solutions:["ÙØ­Øµ Ø§Ù„Ø«Ø±Ù…ÙˆØ³ØªØ§Øª ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡","ÙØ­Øµ Ù…Ø³ØªÙˆÙ‰ Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØ¨Ø±ÙŠØ¯","ÙØ­Øµ Ø­Ø³Ø§Ø³ Ø§Ù„Ø­Ø±Ø§Ø±Ø©"]
      },
      {
        code:"P0135",
        title:"Ø¯Ø§Ø¦Ø±Ø© Ø³Ø®Ø§Ù† Ø­Ø³Ø§Ø³ Ø§Ù„Ø§ÙƒØ³Ø¬ÙŠÙ† B1S1",
        brands:["all"],
        system:"Ø­Ø³Ø§Ø³Ø§Øª",
        description:"Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ø³Ø®Ø§Ù† Ù„Ø­Ø³Ø§Ø³ Ø§Ù„Ø£ÙƒØ³Ø¬ÙŠÙ† (heater) ÙÙŠ Ø§Ù„Ø¨Ù†Ùƒ 1ØŒ Ø§Ù„Ø­Ø³Ø§Ø³ Ù„Ø§ ÙŠØ³Ø®Ù†.",
        causes:["Ø±ÙŠÙ„Ø§ÙŠ/ÙÙŠÙˆØ² Ø§Ù„Ø³Ø®Ø§Ù† Ù…Ù‚Ø·ÙˆØ¹","ØªÙˆØµÙŠÙ„Ø§Øª Ø§Ù„Ø³Ø®Ø§Ù† Ù…Ù…Ø²Ù‚Ø©","Ø­Ø³Ø§Ø³ Ø§Ù„Ø§ÙƒØ³Ø¬ÙŠÙ† Ø®Ø±Ø¨Ø§Ù†"],
        solutions:["ÙØ­Øµ Ø§Ù„ÙÙŠÙˆØ² ÙˆØ§Ù„Ø±ÙŠÙ„Ø§ÙŠ","ÙØ­Øµ Ø§Ù„ØªÙˆØµÙŠÙ„Ø§Øª","Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø­Ø³Ø§Ø³ O2 Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©"]
      },
      {
        code:"P0455",
        title:"ØªØ³Ø±ÙŠØ¨ ÙƒØ¨ÙŠØ± ÙÙŠ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¨Ø®Ø± (EVAP)",
        brands:["all"],
        system:"evap",
        description:"ØªØ³Ø±ÙŠØ¨ ÙƒØ¨ÙŠØ± ÙÙŠ Ù†Ø¸Ø§Ù… ØªØ¨Ø®Ø± Ø§Ù„ÙˆÙ‚ÙˆØ¯â€”ØºØ·Ø§Ø¡ Ø§Ù„Ø®Ø²Ø§Ù† Ø£Ùˆ Ø®Ø· Ù…ØªØ¶Ø±Ø±.",
        causes:["ØºØ·Ø§Ø¡ ÙˆÙ‚ÙˆØ¯ ØºÙŠØ± Ù…Ø­ÙƒÙ…/Ù…ÙƒØ³ÙˆØ±","Ø®Ø· EVAP Ù…ØªØ¶Ø±Ø±","ØµÙ…Ø§Ù… EVAP Ù…Ø¹Ø·ÙˆØ¨"],
        solutions:["ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø­ÙƒØ§Ù… ØºØ·Ø§Ø¡ Ø§Ù„Ø¨Ù†Ø²ÙŠÙ†","ÙØ­Øµ Ø®Ø±Ø§Ø·ÙŠÙ… EVAP ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§","ÙØ­Øµ ØµÙ…Ø§Ù… EVAP"]
      },
      // Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ ÙƒÙˆØ¯ Ù…Ø®ØµØµ Ù„Ù…Ø§Ø±ÙƒØ©
      {
        code:"P1336",
        title:"Ø®Ù„Ù„ Ø¥Ø´Ø§Ø±Ø© ÙƒØ±Ù†Ùƒ â€” Ø±Ù…ÙˆØ² Ø´Ø§Ø¦Ø¹Ø© ÙÙŠ Ø¨Ø¹Ø¶ Ø±ÙŠÙ†Ùˆ/Ø¨ÙŠØ¬Ùˆ",
        brands:["Renault","Peugeot"],
        system:"Ù…Ø­Ø±Ùƒ",
        description:"ÙÙ‚Ø¯Ø§Ù† Ø£Ùˆ Ø¹Ø¯Ù… Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø¥Ø´Ø§Ø±Ø© Ø­Ø³Ø§Ø³ Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…Ø±ÙÙ‚ ÙŠØ³Ø¨Ø¨ Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ Ø§Ù„Ø§Ø´ØªØ¹Ø§Ù„/Ø§Ù„ØªØ²Ø§Ù…Ù†.",
        causes:["Ø­Ø³Ø§Ø³ Ø§Ù„ÙƒØ±Ù†Ùƒ ØªØ§Ù„Ù","Ø£Ø³Ù„Ø§Ùƒ Ù…Ù‚Ø·ÙˆØ¹Ø©/ØªØ£ÙƒØ³Ø¯","Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ ØªØ±Ø³ Ø§Ù„Ø­Ø³Ø§Ø³"],
        solutions:["Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø­Ø³Ø§Ø³ Ø§Ù„ÙƒØ±Ù†Ùƒ","ÙØ­Øµ Ø§Ù„Ø¶ÙÙŠØ±Ø© ÙˆØ§Ù„ÙˆØµÙ„Ø§Øª","ÙØ­Øµ ØªØ±ÙˆØ³ ÙˆÙ…ÙˆØ§Ø¶Ø¹ Ø§Ù„Ø­Ø³Ø§Ø³"]
      }
    ];

    // helper: find by code exact
    function findByCode(code){
      if(!code) return null;
      const c = code.trim().toUpperCase();
      return DB.find(item => item.code.toUpperCase() === c) || null;
    }

    function keywordMatch(text){
      const q = (text||"").toLowerCase();
      if(!q) return [];
      // search causes/description/title for keywords
      return DB.filter(item => {
        const hay = (item.title + " " + item.description + " " + (item.causes||[]).join(" ")).toLowerCase();
        return q.split(/\s+/).some(tok => tok.length>2 && hay.includes(tok));
      });
    }

    function analyze(){
      const brand = document.getElementById('brand').value || 'all';
      const model = document.getElementById('model').value || '';
      const year = document.getElementById('year').value || '';
      const code = document.getElementById('code').value || '';
      const desc = document.getElementById('desc').value || '';

      const output = document.getElementById('outputArea');
      output.innerHTML = '';

      // metadata
      const meta = document.getElementById('metaInfo');
      meta.textContent = `Ù…Ø§Ø±ÙƒØ©: ${brand} Â· Ù…ÙˆØ¯ÙŠÙ„: ${model||'â€”'} Â· Ø³Ù†Ø©: ${year||'â€”'} Â· ÙƒÙˆØ¯: ${code||'â€”'}`;

      // attempt
      let found = null;
      if(code.trim()){
        found = findByCode(code);
      }

      const matchesFromDesc = keywordMatch(desc);
      let combined = [];
      if(found) combined.push(found);
      // add matches but avoid duplicates by code
      matchesFromDesc.forEach(m=>{
        if(!combined.some(c=>c.code===m.code)) combined.push(m);
      });

      // If no matches, try fuzzy code prefix match (e.g., user typed "0300")
      if(!found && code.trim()){
        const prefix = code.replace(/[^A-Za-z0-9]/g,'').toUpperCase();
        const alt = DB.filter(item => item.code.toUpperCase().includes(prefix));
        alt.forEach(m=>{ if(!combined.some(c=>c.code===m.code)) combined.push(m); });
      }

      // If still empty, try generic search by description words
      if(combined.length===0 && desc.trim()){
        const more = keywordMatch(desc);
        more.forEach(m=>{ if(!combined.some(c=>c.code===m.code)) combined.push(m); });
      }

      if(combined.length===0){
        // no results â€” show helpful fallback
        const e = document.createElement('div');
        e.className = 'empty';
        e.innerHTML = `<div style="font-weight:700;margin-bottom:8px">Ù„Ù… Ù†Ø¹Ø«Ø± Ø¹Ù„Ù‰ ØªØ·Ø§Ø¨Ù‚ Ù…Ø¨Ø§Ø´Ø±</div>
          <div>Ø¬Ø±Ø¨ ÙƒØªØ§Ø¨Ø© Ø§Ù„ÙƒÙˆØ¯ Ø¨ØµÙŠØºØ© Ù…Ø«Ù„ <strong>P0300</strong> Ø£Ùˆ ÙˆØµÙ Ø§Ù„Ø­Ø§Ù„Ø© Ø¨ÙƒÙ„Ù…Ø§Øª Ø£ÙˆØ¶Ø­. ÙŠÙ…ÙƒÙ†Ùƒ Ø£ÙŠØ¶Ù‹Ø§ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª JSON Ø£ÙƒØ¨Ø± Ù„Ø§Ø­Ù‚Ù‹Ø§.</div>`;
        output.appendChild(e);
        return;
      }

      // show list of found faults
      combined.forEach(item=>{
        const wrp = document.createElement('div');
        wrp.className = 'fault';
        wrp.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;">
            <div>
              <div style="color:var(--muted);font-size:13px">Ø§Ù„ÙƒÙˆØ¯</div>
              <div style="font-size:18px;font-weight:800">${item.code}</div>
            </div>
            <div style="text-align:left">
              <div style="font-size:13px;color:var(--muted)">${item.brands && item.brands.length ? item.brands.join(' Â· ') : 'Ø¹Ø§Ù…'}</div>
              <div style="font-weight:700;margin-top:6px">${item.title}</div>
            </div>
          </div>
          <div style="margin-top:10px;color:var(--muted);">${item.description || ''}</div>
          <div style="margin-top:10px">
            <strong>Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©:</strong>
            <ul>${(item.causes||[]).map(c=>`<li>${c}</li>`).join('')}</ul>
          </div>
          <div style="margin-top:10px">
            <strong>Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ù…Ù…ÙƒÙ†Ø©:</strong>
            <ul>${(item.solutions||[]).map(s=>`<li>${s}</li>`).join('')}</ul>
          </div>
        `;
        output.appendChild(wrp);
      });

      // analysis block: synthesize Arabic explanation
      const analysis = document.createElement('div');
      analysis.className = 'analysis';
      const codesList = combined.map(c=>c.code).join(', ');
      const systems = Array.from(new Set(combined.map(c=>c.system))).join(' Â· ');
      let analysisText = `ØªØ­Ù„ÙŠÙ„ Ø¹Ø§Ù…: Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª (Ù…Ø§Ø±ÙƒØ©: ${brand}, Ù…ÙˆØ¯ÙŠÙ„: ${model||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}, Ø³Ù†Ø©: ${year||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©'}) ÙˆØ§Ù„ÙƒÙˆØ¯/Ø§Ù„Ø£ÙˆØµØ§Ù (${codesList})ØŒ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªÙ†ØªØ§Ø¬ Ø£Ù† Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£ØºÙ„Ø¨ Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù€: ${systems}.\n\n`;
      // add short tailored advice
      analysisText += `Ù†ØµØ§Ø¦Ø­ ÙÙˆØ±ÙŠØ©:\n`;
      analysisText += `â€¢ Ø§Ø¨Ø¯Ø£ Ø¨ÙØ­Øµ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø³Ù‡Ù„Ø©: Ø´Ù…Ø¹Ø§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§Ù‚ØŒ ØªÙˆØµÙŠÙ„Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø§ØªØŒ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙˆÙ‚ÙˆØ¯ ÙˆØ³ÙˆØ§Ø¦Ù„ Ø§Ù„ØªØ¨Ø±ÙŠØ¯.\n`;
      analysisText += `â€¢ Ø¥Ù† ÙƒØ§Ù† Ø¶ÙˆØ¡ Ø§Ù„Ù…Ø­Ø±Ùƒ Ù…Ø¶ÙŠØ¡ ÙˆØ¸Ù‡Ø±Øª ÙƒÙˆØ¯ P0300 Ø£Ùˆ P0171 ÙØ§ÙØ­Øµ Ø´Ù…Ø¹Ø§Øª ÙˆÙØªØ­Ø§Øª Ø§Ù„Ø¨Ø®Ø§Ø® ÙˆØ§Ù„Ù…Ø§Ù.\n`;
      analysisText += `â€¢ Ø§Ù† Ù„Ù… ØªÙƒÙ† Ù…ØªØ£ÙƒØ¯Ù‹Ø§ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ØŒ Ù‚Ù… Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ø¨Ø§Ù„ØªÙØµÙŠÙ„ ÙˆØ§Ø·Ù„Ø¨ ÙØ­Øµ OBD Ù„Ø¯Ù‰ Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ Ù…Ø®ØªØµ Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø§Ù„ÙˆÙ‚ØªÙŠÙ‘Ø© (Live data).\n\n`;
      analysisText += `Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ù…Ø¯Ø±Ø¬Ø© Ø£Ø¹Ù„Ø§Ù‡ Ù‡ÙŠ Ø­Ù„ÙˆÙ„ Ù…Ø¨Ø¯Ø¦ÙŠØ©. Ù‚Ø¯ ÙŠØ­ØªØ§Ø¬ Ø§Ù„ØªØ´Ø®ÙŠØµ Ø¥Ù„Ù‰ Ø£Ø¯ÙˆØ§Øª (ÙØ­Øµ Ø¶ØºØ· Ø§Ù„Ø§Ø³Ø·ÙˆØ§Ù†Ø§ØªØŒ ÙØ­Øµ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ) ÙˆØ¥Ù„Ù‰ ÙÙ†ÙŠ Ù…Ø®ØªØµ Ø¹Ù†Ø¯ ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø­Ù„ Ø§Ù„Ø¨Ø³ÙŠØ·.`;

      // format into paragraphs
      analysis.innerHTML = `<h4 style="margin:0 0 8px 0;">ğŸ” ØªØ­Ù„ÙŠÙ„ Ù…ÙˆØ¬Ø² Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</h4><pre style="white-space:pre-wrap;margin:0;line-height:1.5;color:#dfeeff">${analysisText}</pre>`;
      output.appendChild(analysis);
    }

    // buttons
    document.getElementById('analyzeBtn').addEventListener('click', analyze);
    document.getElementById('resetBtn').addEventListener('click', ()=>{
      document.getElementById('brand').value = 'all';
      document.getElementById('model').value = '';
      document.getElementById('year').value = '';
      document.getElementById('code').value = '';
      document.getElementById('desc').value = '';
      document.getElementById('outputArea').innerHTML = '<div class="empty"><div style="font-weight:700;margin-bottom:8px">Ù„Ù… ÙŠØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ ØªØ´Ø®ÙŠØµ Ø¨Ø¹Ø¯</div><div>Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ OBD Ø£Ùˆ ÙˆØµÙ Ø§Ù„Ø­Ø§Ù„Ø© Ø«Ù… Ø§Ø¶ØºØ· \"ØªØ´Ø®ÙŠØµ Ø§Ù„Ø¢Ù†\".</div></div>';
      document.getElementById('metaInfo').textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªÙŠØ¬Ø© â€” Ø§Ø¶ØºØ· \"ØªØ´Ø®ÙŠØµ Ø§Ù„Ø¢Ù†\".';
    });

    document.getElementById('copyBtn').addEventListener('click', ()=>{
      const output = document.getElementById('outputArea').innerText;
      navigator.clipboard?.writeText(output).then(()=> alert('ØªÙ… Ù†Ø³Ø® Ù…Ù„Ø®Øµ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø© âœ…')).catch(()=> alert('ØªØ¹Ø°Ø± Ø§Ù„Ù†Ø³Ø® â€” Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ø­Ø¯ÙŠØ«.'));
    });

    document.getElementById('exportBtn').addEventListener('click', ()=>{
      // gather current displayed results into JSON
      const brand = document.getElementById('brand').value || 'all';
      const model = document.getElementById('model').value || '';
      const year = document.getElementById('year').value || '';
      const code = document.getElementById('code').value || '';
      const desc = document.getElementById('desc').value || '';
      const resultsText = document.getElementById('outputArea').innerText || '';
      const payload = { brand, model, year, code, desc, resultsText, exportedAt: new Date().toISOString() };
      const blob = new Blob([JSON.stringify(payload, null, 2)],{type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `dali_diagnostic_${Date.now()}.json`;
      a.click();
      URL.revokeObjectURL(url);
    });

    // init empty UI
    document.getElementById('resetBtn').click();
  </script>
</body>
</html>
