<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Builder â€” Dali Nadjib AI Voiture (Single-file generator)</title>
<style>
  :root{
    --bg:#05060a; --card:rgba(255,255,255,0.02); --muted:#9aa4b2;
    --accent1:#ff6b6b; --accent2:#7c5cff; --accent3:#00d4ff; --glass: rgba(255,255,255,0.03);
    --radius:12px;
  }
  *{box-sizing:border-box;font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans", Arial;}
  body{ margin:0; min-height:100vh; background: linear-gradient(180deg,#07101a 0%, #020305 100%); color:#e7f2ff; padding:18px; }
  .wrap{ max-width:1100px; margin:0 auto; display:grid; grid-template-columns: 1fr 420px; gap:16px; align-items:start; }
  h1{ margin:0 0 10px 0; font-size:20px; display:flex; gap:8px; align-items:center; }
  .card{ background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:16px; border-radius:var(--radius); border:1px solid rgba(255,255,255,0.03); }
  label{ display:block; font-size:13px; color:var(--muted); margin-bottom:6px; }
  input[type="text"], textarea, select { width:100%; padding:10px; border-radius:10px; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03); color:inherit; }
  textarea{ min-height:140px; }
  .btn{ padding:10px 12px; border-radius:10px; background:linear-gradient(90deg,var(--accent2),var(--accent3)); color:#04040a; font-weight:800; border:none; cursor:pointer; }
  .btn-ghost{ background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--muted); padding:8px 10px; border-radius:10px; cursor:pointer; }
  .muted{ color:var(--muted); font-size:13px; }
  .small{ font-size:12px; color:var(--muted); margin-top:8px; }
  .file-row{ display:flex; gap:8px; align-items:center; }
  pre{ background:rgba(0,0,0,0.25); padding:10px; border-radius:8px; color:#dfefff; max-height:220px; overflow:auto; }
  @media (max-width:980px){ .wrap{ grid-template-columns:1fr; } }
</style>
</head>
<body>
  <div class="wrap">
    <main class="card">
      <h1>Ù…ÙˆÙ„Ù‘Ø¯ Ù…Ù„Ù HTML ÙˆØ§Ø­Ø¯ â€” Dali Nadjib AI Voiture</h1>
      <div class="muted">Ø§ØªØ¨Ø¹ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù HTML ÙˆØ§Ø­Ø¯ ÙŠØ­ØªÙˆÙŠ ØµÙˆØ±ØªÙƒ ÙˆÙ‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ (Ù…Ø¶Ù…Ù‘Ù†Ø© Base64/JSON).</div>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0;">

      <label>1) Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ (ØªÙØ¯Ù…Ø¬ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ)</label>
      <div class="file-row">
        <input id="imgFile" type="file" accept="image/*" />
        <button class="btn-ghost" id="previewImgBtn">Ù…Ø¹Ø§ÙŠÙ†Ø©</button>
      </div>
      <div id="imgPreview" style="margin-top:8px;"></div>

      <label style="margin-top:12px">2) Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ (codes.json) Ø£Ùˆ Ù„ØµÙ‚ JSON Ù‡Ù†Ø§</label>
      <div class="file-row">
        <input id="codesFile" type="file" accept="application/json" />
        <button class="btn-ghost" id="loadSampleBtn">ØªØ­Ù…ÙŠÙ„ Ø¹ÙŠÙ‘Ù†Ø© ØµØºÙŠØ±Ø© (Ø¹Ø±Ø¶)</button>
      </div>
      <div style="margin-top:8px;">
        <textarea id="codesText" placeholder='ÙŠÙ…ÙƒÙ†Ùƒ Ù„ØµÙ‚ Ù…Ø­ØªÙˆÙ‰ Ù…Ù„Ù JSON Ù‡Ù†Ø§ (Ù…ØµÙÙˆÙØ© Ù…Ù† Ø§Ù„Ø³Ø¬Ù„Ø§Øª: [{"code":"P0300","title":"...","description":"...","causes":["..."],"solutions":["..."]}, ...])'></textarea>
      </div>
      <div class="small">Ù…Ù„Ù JSON ÙƒØ§Ù…Ù„ (ÙƒÙ„ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯) Ù…Ø·Ù„ÙˆØ¨ Ù„Ø¯Ù…Ø¬ "Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯". Ø¥Ù† ÙƒØ§Ù† Ù„Ø¯ÙŠÙƒ Ù…Ù„Ù Ø®Ø§Ø±Ø¬ÙŠ ÙƒØ¨ÙŠØ± â€” Ø§Ø±ÙØ¹Ù‡ Ù‡Ù†Ø§ ÙˆØ³ÙŠÙØ¯Ù…Ø¬ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.</div>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0;">

      <label>3) Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</label>
      <label class="small">Ø§Ø³Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¸Ø§Ù‡Ø± ÙÙŠ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</label>
      <input id="appName" type="text" value="Dali Nadjib AI Voiture" />

      <label class="small" style="margin-top:8px">ØªÙˆØ¶ÙŠØ­ ØµØºÙŠØ± ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰</label>
      <input id="appTag" type="text" value="ÙˆØ§Ø¬Ù‡Ø© ØªØ´Ø®ÙŠØµ OBD Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© â€” Ù…Ù„Ù ÙˆØ§Ø­Ø¯ Ø´Ø§Ù…Ù„" />

      <div style="display:flex;gap:10px;margin-top:12px;">
        <button class="btn" id="buildBtn">ğŸ› ï¸ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù HTML ÙƒØ§Ù…Ù„ (Single-file)</button>
        <button class="btn-ghost" id="downloadCurrentBtn">â¬‡ï¸ ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚Ù„ ÙÙ‚Ø·)</button>
      </div>

      <div style="margin-top:12px;">
        <div class="small">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ù„Ù Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ ÙƒØ¨ÙŠØ±Ù‹Ø§ (Ù…ÙŠØºØ§Ø¨Ø§ÙŠØªØ§Øª Ø¹Ø¯Ø©)ØŒ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ù Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø¨Ø¹Ø¶ Ø§Ù„ÙˆÙ‚Øª â€” ÙƒÙ„ Ø§Ù„ØªÙˆÙ„ÙŠØ¯ ÙŠØ­Ø¯Ø« Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ù…ØªØµÙØ­Ùƒ.</div>
      </div>

    </main>

    <aside class="card">
      <h3>Ù…Ø¹Ø§ÙŠÙ†Ø© / Ø¯Ù„Ø§Ø¦Ù„</h3>
      <div class="small" style="margin-bottom:8px;">Ø­Ø§Ù„Ø© Ø§Ù„Ø±ÙØ¹ ÙˆØ§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©:</div>
      <div id="statusArea">
        <div class="muted">Ù„Ù… ÙŠØªÙ… Ø±ÙØ¹ ØµÙˆØ±Ø© Ø£Ùˆ Ù…Ù„Ù Ø£ÙƒÙˆØ§Ø¯ Ø¨Ø¹Ø¯.</div>
      </div>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0;">

      <h4>ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h4>
      <ol class="small">
        <li>Ø§Ø±ÙØ¹ ØµÙˆØ±ØªÙƒ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø²Ø± "Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù".</li>
        <li>Ø§Ø±ÙØ¹ Ù…Ù„Ù `codes.json` Ø§Ù„Ø°ÙŠ ÙŠØ­ÙˆÙŠ ÙƒÙ„ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ (Ø¥Ù† ÙˆØ¬Ø¯) Ø£Ùˆ Ø£Ù„ØµÙ‚ JSON ÙÙŠ Ø§Ù„Ø­Ù‚Ù„.</li>
        <li>Ø§Ø¶ØºØ· "Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù HTML ÙƒØ§Ù…Ù„" Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ù„Ù ÙˆØ§Ø­Ø¯ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙ†Ø²ÙŠÙ„.</li>
      </ol>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0;">

      <h4>Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØªÙ‚Ù†ÙŠØ©</h4>
      <div class="small">
        â€¢ ÙƒÙ„ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ­Ø¯Ø« Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ù…ØªØµÙØ­Ùƒ â€” Ù„Ø§ Ø´ÙŠØ¡ ÙŠÙØ±Ø³Ù„ Ù„Ù„Ø®ÙˆØ§Ø¯Ù….<br>
        â€¢ Ø¥Ù† Ø£Ø±Ø¯ØªØŒ Ø£Ø³ØªØ·ÙŠØ¹ ØªÙˆÙ„ÙŠØ¯ Ù„Ùƒ Ù…Ù„Ù JSON ÙƒØ§Ù…Ù„ Ø¨Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ (Ø¥Ù† Ø±ØºØ¨Ù‘Øª) â€” Ø³Ø£Ø­ØªØ§Ø¬ Ø¨Ø¹Ø¶ Ø§Ù„ÙˆÙ‚Øª Ù„Ø°Ù„Ùƒ ÙˆÙŠÙƒÙˆÙ† Ø¶Ù…Ù† Ø±Ø¯ Ù…Ù†ÙØµÙ„.
      </div>
    </aside>
  </div>

<script>
/* Helper: read file as text/base64 */
function fileToBase64(file){
  return new Promise((res, rej)=>{
    const r = new FileReader();
    r.onload = ()=> res(r.result);
    r.onerror = ()=> rej(new Error('ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù'));
    r.readAsDataURL(file); // returns data:<mime>;base64,....
  });
}
function fileToText(file){
  return new Promise((res, rej)=>{
    const r = new FileReader();
    r.onload = ()=> res(r.result);
    r.onerror = ()=> rej(new Error('ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù'));
    r.readAsText(file);
  });
}

/* UI elements */
const imgFile = document.getElementById('imgFile');
const codesFile = document.getElementById('codesFile');
const codesText = document.getElementById('codesText');
const previewArea = document.getElementById('imgPreview');
const statusArea = document.getElementById('statusArea');
const buildBtn = document.getElementById('buildBtn');
const downloadCurrentBtn = document.getElementById('downloadCurrentBtn');
const previewImgBtn = document.getElementById('previewImgBtn');
const loadSampleBtn = document.getElementById('loadSampleBtn');

let uploadedImageDataUrl = null;
let uploadedCodesJson = null;

/* preview image */
previewImgBtn.addEventListener('click', async ()=>{
  const f = imgFile.files?.[0];
  if(!f) return alert('Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹');
  try{
    const data = await fileToBase64(f);
    uploadedImageDataUrl = data;
    previewArea.innerHTML = `<div style="display:flex;gap:8px;align-items:center">
      <img src="${data}" alt="Ù…Ø¹Ø§ÙŠÙ†Ø©" style="width:96px;height:96px;border-radius:12px;object-fit:cover;border:1px solid rgba(255,255,255,0.04)"/>
      <div class="muted">ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© â€” Ø³ÙŠØªÙ… ØªØ¶Ù…ÙŠÙ†Ù‡Ø§ ÙÙŠ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ÙƒÙ€ Base64.</div>
    </div>`;
    statusArea.innerHTML = `<div class="muted">ğŸ“¸ ØµÙˆØ±Ø© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¯Ù…Ø¬.</div>`;
  }catch(e){ alert('ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØµÙˆØ±Ø©'); console.error(e); }
});

/* load sample codes (small) */
loadSampleBtn.addEventListener('click', ()=>{
  // small sample JSON to allow user to try the generator
  const sample = [
    {"code":"P0300","title":"Ø®Ù„Ù„ Ø§Ø­ØªØ±Ø§Ù‚ Ø¹Ø´ÙˆØ§Ø¦ÙŠ","description":"Ø§Ø­ØªØ±Ø§Ù‚ ØºÙŠØ± Ù…Ù†ØªØ¸Ù…...","causes":["Ø´Ù…Ø¹Ø§Øª ØªØ§Ù„ÙØ©","ÙƒÙˆÙŠÙ„Ø§Øª"],"solutions":["ØªØºÙŠÙŠØ± Ø§Ù„Ø´Ù…Ø¹Ø§Øª","ÙØ­Øµ Ø§Ù„ÙƒÙˆÙŠÙ„Ø§Øª"]},
    {"code":"P0420","title":"ÙƒÙØ§Ø¡Ø© Ø§Ù„Ù…Ø­ÙˆÙ„ Ù…Ù†Ø®ÙØ¶Ø©","description":"Ø§Ù†Ø®ÙØ§Ø¶ Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø­ÙˆÙ„ Ø§Ù„Ø­ÙØ§Ø²","causes":["Ù…Ø­ÙˆÙ„ ØªØ§Ù„Ù","Ø­Ø³Ø§Ø³Ø§Øª O2"],"solutions":["ÙØ­Øµ Ø§Ù„Ù…Ø­ÙˆÙ„","Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø­Ø³Ø§Ø³ O2"]}
  ];
  codesText.value = JSON.stringify(sample, null, 2);
  statusArea.innerHTML = `<div class="muted">ğŸ“„ Ø¹ÙŠÙ‘Ù†Ø© ØµØºÙŠØ±Ø© Ø£Ø¶ÙŠÙØª Ø¨Ø§Ù„Ù†Øµ. Ù„ØµÙ‚ Ù…Ù„Ù JSON ÙƒØ§Ù…Ù„ Ø³ÙŠØ­Ù„ Ù…Ø­Ù„Ù‡.</div>`;
});

/* upload codes file */
codesFile.addEventListener('change', async (e)=>{
  const f = e.target.files?.[0];
  if(!f) return;
  try{
    const txt = await fileToText(f);
    codesText.value = txt;
    statusArea.innerHTML = `<div class="muted">ğŸ“„ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø£ÙƒÙˆØ§Ø¯. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Øµ Ø£Ùˆ Ø§Ù„Ù…Ø¶ÙŠ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ù.</div>`;
  }catch(err){ alert('ÙØ´Ù„ Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„Ø£ÙƒÙˆØ§Ø¯'); console.error(err); }
});

/* download helper */
function downloadBlob(filename, content){
  const blob = new Blob([content], {type:'text/html;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = filename; a.click();
  URL.revokeObjectURL(url);
}

/* Build single-file HTML */
buildBtn.addEventListener('click', async ()=>{
  const appName = document.getElementById('appName').value || 'Dali Nadjib AI Voiture';
  const appTag = document.getElementById('appTag').value || '';
  // image: if user uploaded but didn't preview, read now
  try{
    if(!uploadedImageDataUrl && imgFile.files?.[0]){
      uploadedImageDataUrl = await fileToBase64(imgFile.files[0]);
    }
  }catch(e){ console.warn('no image'); }

  // codes JSON: from textarea
  const codesRaw = codesText.value && codesText.value.trim();
  if(!codesRaw){
    if(!confirm('Ù„Ù… ØªØ¶Ø¹ Ù…Ù„Ù JSON Ù„Ù„Ø£ÙƒÙˆØ§Ø¯ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ù‚Ù„ â€” Ø§Ø³ØªÙ…Ø± ÙˆØ³ÙŠÙÙ†Ø´Ø£ Ù…Ù„Ù Ø¯ÙˆÙ† Ù‚Ø§Ø¹Ø¯Ø© Ø£ÙƒÙˆØ§Ø¯ (ÙŠÙ…ÙƒÙ† Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù„Ø§Ø­Ù‚Ù‹Ø§)ØŸ')) return;
  }
  // validate JSON
  let codesObj = null;
  if(codesRaw){
    try{
      codesObj = JSON.parse(codesRaw);
      if(!Array.isArray(codesObj)){
        if(!confirm('Ù…Ø­ØªÙˆÙ‰ JSON Ù„ÙŠØ³ Ù…ØµÙÙˆÙØ©. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙˆÙ…Ø­Ø§ÙˆÙ„Ø© ØªØ¶Ù…ÙŠÙ†Ù‡ ÙƒÙ…Ø§ Ù‡ÙˆØŸ')) {
          return;
        }
      }
    }catch(err){
      if(!confirm('Ø§Ù„Ù€ JSON ØºÙŠØ± ØµØ§Ù„Ø­: ' + err.message + '\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØ¶Ù… Ø§Ù„Ù†Øµ ÙƒÙ…Ø§ Ù‡Ùˆ ÙƒÙ†Øµ Ø®Ø§Ù…ØŸ')) {
        return;
      }
    }
  }

  statusArea.innerHTML = `<div class="muted">âš™ï¸ Ø¬Ø§Ø±Ù ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ù„Ù... (Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„)</div>`;

  // Build final HTML content (single-file)
  // The final HTML includes: ÙˆØ§Ø¬Ù‡Ø© ÙƒØ§Ù…Ù„Ø© Ø´Ø¨ÙŠÙ‡Ø© Ø¨Ø§Ù„ØªÙŠ Ù‚Ø¨Ù„ + Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ù…Ø¯Ù…Ø¬Ø© ÙƒÙ…ØªØºÙŠÙ‘Ø± JS (codesData)
  // To avoid extremely long inline, we include codes as a JSON string assigned to a JS variable.
  const imageSnippet = uploadedImageDataUrl ? `<img src="${uploadedImageDataUrl}" alt="logo" style="width:64px;height:64px;border-radius:10px;object-fit:cover;border:1px solid rgba(0,0,0,0.06)"/>` : '';

  // If codesObj is array, we stringify it safely (escape closing script tag)
  let codesJsonString = '';
  if(codesObj){
    codesJsonString = JSON.stringify(codesObj);
    // escape sequence to prevent </script> in content
    codesJsonString = codesJsonString.replace(/<\/script>/gi, '<\\/script>');
  } else {
    // include empty array placeholder
    codesJsonString = '[]';
  }

  // final HTML template (a simplified but full app)
  const finalHtml = `
<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>${escapeHtml(appName)} â€” Ù…Ù„Ù ÙˆØ§Ø­Ø¯</title>
<style>
  :root{ --bg:#05060a; --muted:#9aa4b2; --accent2:#7c5cff; --accent3:#00d4ff; --radius:12px; }
  body{ margin:0; min-height:100vh; background:linear-gradient(180deg,#07101a 0%, #020305 100%); color:#e7f2ff; font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial; padding:18px; }
  .wrap{ max-width:1200px; margin:0 auto; display:grid; grid-template-columns: 380px 1fr; gap:16px; align-items:start; }
  .card{ background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:16px; border-radius:var(--radius); border:1px solid rgba(255,255,255,0.03); }
  h1{ margin:0; font-size:20px; display:flex; gap:8px; align-items:center; }
  label{ display:block; font-size:13px; color:var(--muted); margin-top:10px; margin-bottom:6px; }
  input[type="text"], select, textarea { width:100%; padding:10px; border-radius:10px; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03); color:inherit; }
  textarea{ min-height:120px; }
  .btn{ padding:10px 12px; border-radius:10px; background:linear-gradient(90deg,var(--accent2),var(--accent3)); color:#04040a; font-weight:800; border:none; cursor:pointer; }
  .btn-ghost{ background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--muted); padding:8px 10px; border-radius:10px; cursor:pointer; }
  .avatar{ width:72px; height:72px; border-radius:12px; overflow:hidden; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03); }
  .muted{ color:var(--muted); font-size:13px; }
  .resultCard{ padding:14px; border-radius:10px; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005)); border:1px solid rgba(255,255,255,0.02); }
  .fault{ border-radius:10px; padding:12px; margin-bottom:10px; background: linear-gradient(90deg, rgba(124,92,255,0.04), rgba(0,212,255,0.02)); border:1px solid rgba(124,92,255,0.06); }
  pre.analysis{ white-space:pre-wrap; color:#dfeeff; background:rgba(0,0,0,0.18); padding:12px; border-radius:10px; }
  @media (max-width:980px){ .wrap{ grid-template-columns:1fr; } }
</style>
</head>
<body>
  <div class="wrap">
    <aside class="card" aria-labelledby="title">
      <div style="display:flex;gap:12px;align-items:center;margin-bottom:8px;">
        <div class="avatar">${imageSnippet || '<div style="color:var(--muted);font-weight:800">D N</div>'}</div>
        <div style="flex:1">
          <h1>${escapeHtml(appName)}</h1>
          <div class="muted">${escapeHtml(appTag)}</div>
        </div>
      </div>

      <label>Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</label>
      <select id="brand"><option value="all">Ø¹Ø§Ù… â€” ØºÙŠØ± Ù…Ø­Ø¯Ø¯</option><option>Renault</option><option>Peugeot</option><option>Chery</option><option>Fiat</option><option>Hyundai</option><option>Volkswagen</option><option>BMW</option><option>Other</option></select>

      <label>Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</label>
      <select id="model"><option>Ø¹Ø§Ù… â€” ØºÙŠØ± Ù…Ø­Ø¯Ø¯</option></select>

      <label>Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹</label>
      <input id="year" type="text" placeholder="Ù…Ø«Ø§Ù„: 2015" />

      <label>ÙƒÙˆØ¯ OBD (Ø§ÙƒØªØ¨ Ø£Ùˆ Ø§Ø®ØªØ±)</label>
      <div style="display:flex;gap:8px;">
        <input id="codeInput" type="text" placeholder="P0300" />
        <button class="btn-ghost" id="openList">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</button>
      </div>

      <label>ÙˆØµÙ Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©</label>
      <textarea id="desc" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ù…Ø­Ø±Ùƒ ÙŠÙ‡ØªØ² Ø¹Ù†Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„..."></textarea>

      <div style="display:flex;gap:8px;margin-top:12px;">
        <button class="btn" id="analyzeBtn">ğŸ” ØªØ´Ø®ÙŠØµ Ø§Ù„Ø¢Ù†</button>
        <button class="btn-ghost" id="resetBtn">â™»ï¸ Ù…Ø³Ø­</button>
      </div>
    </aside>

    <main class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div><strong>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ´Ø®ÙŠØµ</strong><div class="muted" id="meta">Ù„Ù… ÙŠØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ ØªØ´Ø®ÙŠØµ Ø¨Ø¹Ø¯</div></div>
        <div><button class="btn-ghost" id="copyBtn">ğŸ“‹ Ù†Ø³Ø®</button></div>
      </div>
      <div id="output" class="resultCard" style="margin-top:12px;">
        <div class="muted">Ø§Ø¶ØºØ· "ØªØ´Ø®ÙŠØµ Ø§Ù„Ø¢Ù†" Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„.</div>
      </div>
    </main>
  </div>

<script>
/* Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¶Ù…Ù‘Ù†Ø© */
const CODES_DB = ${codesJsonString};

/* Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª (Ù…Ø¨Ø³Ø·Ø©) */
const MODELS = {
  "Renault":["Clio","Symbol","Megane","Kangoo","Captur"],
  "Peugeot":["206","207","208","301","308"],
  "Chery":["Tiggo 3","Tiggo 7"],
  "Fiat":["Punto","500"],
  "Hyundai":["Accent","i10","i20","Elantra"],
  "Volkswagen":["Golf","Polo"],
  "BMW":["3 Series","5 Series"],
  "Other":["Ù…ÙˆØ¯ÙŠÙ„ Ø¢Ø®Ø±"],
  "all":["Ø¹Ø§Ù… â€” ØºÙŠØ± Ù…Ø­Ø¯Ø¯"]
};

function fillModelsFor(brand){
  const sel = document.getElementById('model');
  sel.innerHTML='';
  (MODELS[brand]||MODELS['Other']).forEach(m=>{
    const o = document.createElement('option'); o.value=m; o.textContent=m; sel.appendChild(o);
  });
}
fillModelsFor('all');
document.getElementById('brand').addEventListener('change', e => fillModelsFor(e.target.value));

/* show code selector modal */
document.getElementById('openList').addEventListener('click', ()=>{
  const overlay = document.createElement('div'); overlay.style.position='fixed'; overlay.style.inset=0; overlay.style.background='rgba(0,0,0,0.6)'; overlay.style.display='flex'; overlay.style.alignItems='center'; overlay.style.justifyContent='center'; overlay.style.zIndex=9999;
  const box = document.createElement('div'); box.style.width='80%'; box.style.maxHeight='80vh'; box.style.overflow='auto'; box.style.background='linear-gradient(180deg,#08101a,#061018)'; box.style.padding='12px'; box.style.borderRadius='10px';
  const header = document.createElement('div'); header.style.display='flex'; header.style.justifyContent='space-between'; header.style.alignItems='center';
  const h = document.createElement('strong'); h.textContent='Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ â€” Ø§Ø®ØªØ± ÙƒÙˆØ¯Ù‹Ø§';
  const close = document.createElement('button'); close.className='btn-ghost'; close.textContent='Ø¥ØºÙ„Ø§Ù‚'; close.addEventListener('click', ()=> overlay.remove());
  header.appendChild(h); header.appendChild(close); box.appendChild(header);
  const search = document.createElement('input'); search.placeholder='Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„ÙƒÙˆØ¯ Ø£Ùˆ Ø¨Ø§Ù„ÙƒÙ„Ù…Ø©'; search.style.width='100%'; search.style.margin='10px 0'; search.style.padding='8px'; box.appendChild(search);
  const list = document.createElement('div'); box.appendChild(list);

  function render(q=''){
    list.innerHTML=''; const qq=(q||'').toLowerCase().trim();
    const items = CODES_DB.filter(it => {
      if(!qq) return true;
      return ((it.code||'') + ' ' + (it.title||'') + ' ' + (it.description||'') + ' ' + (it.causes||[]).join(' ')).toLowerCase().includes(qq);
    });
    items.slice(0,1000).forEach(it=>{
      const row = document.createElement('div'); row.style.padding='8px'; row.style.borderBottom='1px solid rgba(255,255,255,0.02)'; row.style.cursor='pointer';
      row.innerHTML = '<div style="display:flex;justify-content:space-between;align-items:center;"><div><strong>'+escapeHtml(it.code||'')+'</strong> <span style="color:var(--muted);margin-left:8px">'+escapeHtml(it.title||'')+'</span></div><div style="color:var(--muted)">'+(it.brands?it.brands.join(' Â· '):'Ø¹Ø§Ù…')+'</div></div>';
      row.addEventListener('click', ()=>{ document.getElementById('codeInput').value = it.code || ''; overlay.remove(); });
      list.appendChild(row);
    });
    if(items.length===0) list.innerHTML='<div class="muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>';
  }
  render();
  search.addEventListener('input', (e)=> render(e.target.value));
  overlay.appendChild(box); document.body.appendChild(overlay);
});

/* search helpers */
function findByCode(code){
  if(!code) return null;
  const c = code.toString().trim().toUpperCase();
  return CODES_DB.filter(it => (it.code||'').toString().toUpperCase() === c);
}
function keywordMatch(text){
  if(!text) return [];
  const tokens = text.toLowerCase().split(/\\s+/).filter(t=>t.length>2);
  if(tokens.length===0) return [];
  return CODES_DB.filter(item=>{
    const hay = (item.title||'') + ' ' + (item.description||'') + ' ' + (item.causes||[]).join(' ') + ' ' + (item.solutions||[]).join(' ');
    const low = hay.toLowerCase();
    return tokens.some(tok => low.includes(tok));
  });
}

document.getElementById('analyzeBtn').addEventListener('click', ()=>{
  const brand = document.getElementById('brand').value || 'all';
  const model = document.getElementById('model').value || '';
  const year = document.getElementById('year').value || '';
  const code = (document.getElementById('codeInput').value || '').trim().toUpperCase();
  const desc = (document.getElementById('desc').value || '').trim();
  const out = document.getElementById('output'); out.innerHTML=''; document.getElementById('meta').textContent = 'Ù…Ø§Ø±ÙƒØ©: ' + brand + ' Â· Ù…ÙˆØ¯ÙŠÙ„: ' + (model||'â€”') + ' Â· Ø³Ù†Ø©: ' + (year||'â€”') + ' Â· ÙƒÙˆØ¯: ' + (code||'â€”');

  let results = [];
  if(code){
    const byCode = findByCode(code);
    if(byCode.length) results = results.concat(byCode);
    else {
      // prefix match
      const alt = CODES_DB.filter(it => ((it.code||'')+'').toUpperCase().includes(code.replace(/[^A-Z0-9]/g,'')));
      results = results.concat(alt);
    }
  }
  if(desc){
    const matched = keywordMatch(desc);
    matched.forEach(m=>{ if(!results.some(r=>r.code===m.code)) results.push(m); });
  }
  if(results.length===0){
    // fallback: try search code or desc as substring
    const q = (code || desc).toLowerCase();
    if(q){
      const simple = CODES_DB.filter(it => (((it.code||'') + ' ' + (it.title||'') + ' ' + (it.description||'')).toLowerCase().includes(q)));
      simple.forEach(m=>{ if(!results.some(r=>r.code===m.code)) results.push(m); });
    }
  }

  if(results.length===0){
    out.innerHTML = '<div class="muted">Ù„Ù… Ù†Ø¹Ø«Ø± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ â€” Ø¬Ø±Ù‘Ø¨ ØªØºÙŠÙ‘Ø± Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª Ø£Ùˆ Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON Ø£ÙƒØ¨Ø±.</div>';
    return;
  }

  results.forEach(item=>{
    const el = document.createElement('div'); el.className='fault';
    el.innerHTML = '<div style="display:flex;justify-content:space-between;align-items:center;"><div><div style="color:var(--muted);font-size:13px">Ø§Ù„ÙƒÙˆØ¯</div><div style="font-size:18px;font-weight:800">'+escapeHtml(item.code||'')+'</div></div><div style="text-align:left"><div style="font-size:13px;color:var(--muted)">'+((item.brands && item.brands.length)? item.brands.join(' Â· ') : 'Ø¹Ø§Ù…')+'</div><div style="font-weight:800;margin-top:6px">'+escapeHtml(item.title||'')+'</div></div></div><div style="margin-top:10px;color:var(--muted)">'+escapeHtml(item.description||'')+'</div><div style="margin-top:10px"><strong>Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©:</strong><ul>' + ((item.causes||[]).map(c=>'<li>'+escapeHtml(c)+'</li>').join('')) + '</ul></div><div style="margin-top:6px"><strong>Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„Ù…Ù…ÙƒÙ†Ø©:</strong><ul>' + ((item.solutions||[]).map(s=>'<li>'+escapeHtml(s)+'</li>').join('')) + '</ul></div>';
    out.appendChild(el);
  });

  // analysis
  const systems = Array.from(new Set(results.map(r=>r.system))).join(' Â· ');
  const codesList = Array.from(new Set(results.map(r=>r.code))).join(', ');
  const analysis = 'ØªØ­Ù„ÙŠÙ„ Ø¹Ø§Ù…: Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª (Ù…Ø§Ø±ÙƒØ©: ' + brand + ', Ù…ÙˆØ¯ÙŠÙ„: ' + (model||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯') + ', Ø³Ù†Ø©: ' + (year||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©') + ') ÙˆØ§Ù„Ø£ÙƒÙˆØ§Ø¯/Ø§Ù„ÙˆØµÙ (' + codesList + ')ØŒ Ø§Ù„Ù…Ø±Ø¬Ø­ Ø£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø£Ù†Ø¸Ù…Ø©: ' + systems + '.\\n\\nØ§Ù„ØªØ­Ù‚Ù‘Ù‚ Ø§Ù„Ù…ÙˆØµÙ‰ Ø¨Ù‡:\\n1) ÙØ­Øµ Ø§Ù„ÙˆØµÙ„Ø§ØªØŒ Ø§Ù„ÙÙŠÙˆØ²Ø§ØªØŒ Ù…Ø£Ø®Ø° OBD.\\n2) ÙØ­Øµ Ø§Ù„Ø´Ù…Ø¹Ø§Øª ÙˆØ§Ù„ÙƒÙˆÙŠÙ„Ø§Øª ÙˆØ§Ù„Ù…Ø§Ù ÙˆØ§Ù„Ø¨Ø®Ø§Ø®Ø§Øª.\\n3) Ù…Ø±Ø§Ù‚Ø¨Ø© Live data Ø¥Ù† Ø£Ù…ÙƒÙ† Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„.\\n\\nÙ…Ù„Ø§Ø­Ø¸Ø©: ØªÙˆØµÙŠØ§Øª Ù…Ø¨Ø¯Ø¦ÙŠØ© â€” Ù‚Ø¯ ÙŠÙ„Ø²Ù… ÙØ­Øµ Ù…ØªÙ‚Ø¯Ù‘Ù… Ù„Ø¯Ù‰ ÙÙ†ÙŠ.';

  const analysisEl = document.createElement('div'); analysisEl.style.marginTop='12px';
  analysisEl.innerHTML = '<h4 style="margin:0 0 8px 0;">ğŸ” ØªØ­Ù„ÙŠÙ„ Ù…ÙØµÙ‘Ù„ (Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)</h4><pre class="analysis">'+escapeHtml(analysis)+'</pre>';
  out.appendChild(analysisEl);
});

/* copy */
document.getElementById('copyBtn').addEventListener('click', ()=>{
  const txt = document.getElementById('output').innerText;
  navigator.clipboard?.writeText(txt).then(()=> alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ âœ…')).catch(()=> alert('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø® â€” Ø¬Ø±Ø¨ Ù…ØªØµÙØ­ Ø£Ø­Ø¯Ø«'));
});

/* reset */
document.getElementById('resetBtn').addEventListener('click', ()=>{
  document.getElementById('brand').value = 'all';
  fillModelsFor('all');
  document.getElementById('year').value = '';
  document.getElementById('codeInput').value = '';
  document.getElementById('desc').value = '';
  document.getElementById('output').innerHTML = '<div class="muted">Ø§Ø¶ØºØ· "ØªØ´Ø®ÙŠØµ Ø§Ù„Ø¢Ù†" Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„.</div>';
});

/* helper escape */
function escapeHtml(s){ if(!s) return ''; return s.toString().replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\"/g,'&quot;').replace(/'/g,'&#39;'); }

/* final note: ready */
</script>
</body>
</html>
`;

  // download file
  downloadBlob('dali_nadjib_ai_voiture_full.html', finalHtml);
  statusArea.innerHTML = `<div class="muted">âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ù. Ø³ÙŠØªÙ… ØªÙ†Ø²ÙŠÙ„Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ (Ø£Ùˆ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙ†Ø²ÙŠÙ„ ÙÙŠ Ù…ØªØµÙØ­Ùƒ).</div>`;
});

/* download current simple template (without codes) */
downloadCurrentBtn.addEventListener('click', ()=>{
  const appName = document.getElementById('appName').value || 'Dali Nadjib AI Voiture';
  const appTag = document.getElementById('appTag').value || '';
  const sample = '<!doctype html><html><head><meta charset="utf-8"><title>Sample</title></head><body><h1>'+escapeHtml(appName)+'</h1><p>'+escapeHtml(appTag)+'</p></body></html>';
  downloadBlob('dali_nadjib_ai_voiture_sample.html', sample);
  statusArea.innerHTML = '<div class="muted">ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ù†Ø³Ø®Ø© Ø¨Ø³ÙŠØ·Ø©.</div>';
});

/* escape helper (used above) */
function escapeHtml(s){ if(!s) return ''; return s.toString().replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }
</script>
</body>
</html>
