<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dali Nadjib AI Voiture — تشخيص OBD شامل (200 كود)</title>
<style>
:root{
  --bg:#05060a; --muted:#9aa4b2; --accent1:#ff6b6b; --accent2:#7c5cff; --accent3:#00d4ff; --glass:rgba(255,255,255,0.03); --radius:12px;
}
*{box-sizing:border-box;font-family: "Segoe UI", Roboto, "Noto Sans", Arial, sans-serif;}
body{ margin:0; min-height:100vh; background:
  radial-gradient(900px 400px at 8% 10%, rgba(124,92,255,0.08), transparent 6%),
  radial-gradient(700px 300px at 92% 90%, rgba(0,212,255,0.03), transparent 6%),
  var(--bg); color:#eaf4ff; padding:18px;}
.container{ max-width:1200px; margin:0 auto; display:grid; grid-template-columns:380px 1fr; gap:18px; align-items:start;}
.card{ background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:16px; border-radius:var(--radius); border:1px solid rgba(255,255,255,0.04); }
.header{ display:flex; gap:12px; align-items:center; margin-bottom:8px;}
.appBadge{ background:linear-gradient(90deg,var(--accent2),var(--accent3)); color:#020617; padding:8px 12px; border-radius:12px; font-weight:800;}
.title{ font-size:18px; font-weight:800;}
.lead{ color:var(--muted); font-size:13px; margin:6px 0 12px 0;}
label{ display:block; color:var(--muted); font-size:13px; margin:10px 0 6px 0;}
input[type="text"], select, textarea { width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:var(--glass); color:inherit; outline:none; font-size:14px;}
textarea{ min-height:90px; resize:vertical;}
.row{ display:flex; gap:8px;}
.btn{ padding:10px 12px; border-radius:10px; border:none; cursor:pointer; font-weight:800;}
.btn-primary{ background:linear-gradient(90deg,var(--accent2),var(--accent1)); color:#04040a;}
.btn-ghost{ background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--muted);}
.small{ font-size:12px; color:var(--muted); margin-top:8px;}
.avatar{ width:72px; height:72px; border-radius:12px; overflow:hidden; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.04); font-weight:800; color:var(--muted);}
.outputs{ display:flex; flex-direction:column; gap:12px;}
.resHead{ display:flex; justify-content:space-between; align-items:center; gap:10px;}
.badge{ padding:8px 12px; border-radius:999px; background:linear-gradient(90deg,var(--accent3),var(--accent2)); color:#071122; font-weight:900;}
.meta{ color:var(--muted); font-size:13px;}
.resultCard{ padding:14px; border-radius:12px; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005)); border:1px solid rgba(255,255,255,0.02);}
.fault{ border-radius:10px; padding:12px; margin-bottom:10px; background: linear-gradient(90deg, rgba(124,92,255,0.04), rgba(0,212,255,0.02)); border:1px solid rgba(124,92,255,0.06);}
.analysis{ background:rgba(0,0,0,0.16); padding:12px; border-radius:10px; color:#dfeeff;}
.modal-overlay{ position:fixed; inset:0; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; z-index:9999;}
.modal{ width:80%; max-width:980px; max-height:80vh; overflow:auto; background:linear-gradient(180deg,#07101a,#071018); padding:12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); }
.list-row{ padding:10px; border-bottom:1px solid rgba(255,255,255,0.02); cursor:pointer;}
.empty{ text-align:center; color:var(--muted); padding:18px; border-radius:10px; border:1px dashed rgba(255,255,255,0.03);}
.footer-note{ text-align:center; color:var(--muted); margin-top:12px; font-size:13px;}
@media(max-width:980px){ .container{ grid-template-columns:1fr; padding:10px; } }
</style>
</head>
<body>
  <div class="container">
    <!-- LEFT: FORM -->
    <aside class="card" aria-labelledby="appTitle">
      <div class="header">
        <div class="avatar" id="avatarBox">D N</div>
        <div>
          <div class="appBadge">Dali Nadjib AI</div>
          <div class="title" id="appTitle">تشخيص أعطال السيارات — OBD</div>
          <div class="lead">كل شيء بالعربية — اختر أو اكتب الكود واحصل على تحليل وحلول.</div>
        </div>
      </div>

      <label>رفع صورة البروفايل (اختياري)</label>
      <input type="file" id="avatarFile" accept="image/*" />
      <div class="small">سيتم حفظ الصورة محليًا في المتصفح (جلسة العمل).</div>

      <label for="brand">نوع السيارة / الماركة</label>
      <select id="brand">
        <option value="all">عام — غير محدد</option>
        <option value="Renault">Renault</option>
        <option value="Peugeot">Peugeot</option>
        <option value="Chery">Chery</option>
        <option value="Fiat">Fiat</option>
        <option value="Hyundai">Hyundai</option>
        <option value="Volkswagen">Volkswagen</option>
        <option value="BMW">BMW</option>
        <option value="Other">ماركات أخرى</option>
      </select>

      <label for="model">الموديل</label>
      <select id="model"></select>

      <label for="year">سنة الصنع</label>
      <input id="year" type="text" placeholder="مثال: 2017" />

      <label for="system">اختر نظام/فئة الأكواد</label>
      <select id="system">
        <option value="all">كل الأنظمة</option>
        <option value="engine">المحرك</option>
        <option value="fuel">نظام الوقود</option>
        <option value="ignition">الإشعال</option>
        <option value="emissions">العادم</option>
        <option value="transmission">ناقل الحركة</option>
        <option value="sensors">الحساسات</option>
        <option value="electrical">الكهرباء</option>
        <option value="evap">EVAP</option>
        <option value="safety">السلامة</option>
      </select>

      <label for="codeInput">كود OBD (اكتب أو اختر)</label>
      <div class="row">
        <input id="codeInput" type="text" placeholder="مثال: P0300" />
        <button class="btn btn-ghost" id="openCodesBtn">📂 اختر كود</button>
      </div>

      <label for="desc">وصف حالة السيارة</label>
      <textarea id="desc" placeholder="مثال: المحرك يهتز عند التشغيل، ضوء المحرك ثابت"></textarea>

      <div style="display:flex;gap:10px;margin-top:12px;">
        <button class="btn btn-primary" id="analyzeBtn">🔎 تشخيص الآن</button>
        <button class="btn btn-ghost" id="resetBtn">♻️ مسح الحقول</button>
      </div>

      <div style="display:flex;gap:8px;margin-top:12px;">
        <input id="importJson" type="file" accept="application/json" style="display:none"/>
        <button class="btn btn-ghost" id="importBtn">📥 استيراد JSON (كل الأكواد)</button>
      </div>

      <div class="small" style="margin-top:12px;">
        هذه النسخة تحتوي 200 كود شائع مدمج داخل الملف. لاستيراد قائمة أكبر (آلاف الأكواد) استخدم زر الاستيراد.
      </div>
    </aside>

    <!-- RIGHT: OUTPUT -->
    <main class="card outputs" aria-live="polite">
      <div class="resHead">
        <div style="display:flex;gap:12px;align-items:center;">
          <div class="badge">نتائج التشخيص</div>
          <div class="meta" id="metaInfo">لم يتم إجراء تشخيص — اضغط "تشخيص الآن".</div>
        </div>
        <div style="display:flex;gap:8px;">
          <button class="btn btn-ghost" id="copyBtn">📋 نسخ</button>
          <button class="btn btn-ghost" id="downloadBtn">⬇️ تنزيل JSON</button>
        </div>
      </div>

      <div id="outputArea" class="resultCard">
        <div class="empty"><div style="font-weight:700;margin-bottom:6px">لم يتم إجراء تشخيص بعد</div><div>أدخل كود OBD أو صف الحالة ثم اضغط "تشخيص الآن".</div></div>
      </div>

      <div class="card" style="background:transparent;border:none;padding:0;">
        <h4 style="margin:0 0 6px 0;">ملاحظات</h4>
        <ul style="color:var(--muted);margin:6px 0 0 0;padding-left:18px;">
          <li>قاعدة مدمجة: 200 كود شائع. لتحميل كل الأكواد (5000+) يُنصح برفع ملف JSON خارجي لأن إدراجهم داخل HTML قد يبطئ المتصفح.</li>
          <li>كل المخرجات بالعربية: الأعطال، التحليل، الحلول.</li>
        </ul>
      </div>
    </main>

    <footer class="footer-note">© Dali Nadjib AI Voiture — نسخة محلية</footer>
  </div>

<script>
/* ====== قاعدة بيانات مدمجة: P0001 .. P0200 (200 كود) ======
   كل عنصر: { code, title, brands, system, description, causes:[], solutions:[] }
   الحقول مختصرة لاقتصاد المساحة ولكن يمكن توسيعها لاحقًا.
*/
const BUILT_IN_DB = [
{code:"P0001", title:"خلل دائرة التحكم بضخ الوقود 1", brands:["all"], system:"fuel", description:"إشارة تحكم الضخ خارج المدى.", causes:["مشكلة في صمام التحكم","خلل كهربائي في الدائرة"], solutions:["فحص الصمام والملف","فحص الأسلاك والوصلات"]},
{code:"P0002", title:"خلل دائرة التحكم بضخ الوقود 2", brands:["all"], system:"fuel", description:"قراءة مختلفة في دائرة الضخ.", causes:["حساس تالف","توصيلات ضعيفة"], solutions:["فحص الحساس","تحسين التوصيلات"]},
{code:"P0003", title:"خلل في ضغط الوقود", brands:["all"], system:"fuel", description:"انحراف في ضغط الوقود.", causes:["منظم ضغط معطوب","مضخة ضعيفة"], solutions:["فحص منظم الضغط","قياس ضغط المضخة"]},
{code:"P0004", title:"دائرة التحكم بمضخة الوقود", brands:["all"], system:"fuel", description:"خلل إلكتروني في مسار المضخة.", causes:["فيوز/ريلي معطل","أسلاك مقطوعة"], solutions:["فحص الفيوز والريلي","فحص التوصيلات"]},
{code:"P0005", title:"خطأ حساس التدفق/ضخ", brands:["all"], system:"fuel", description:"خلل إشارة حساسات الوقود.", causes:["حساس متسخ","حساس تالف"], solutions:["تنظيف الحساس","استبدال الحساس"]},
{code:"P0100", title:"خلل في حساس تدفق الهواء (MAF)", brands:["all"], system:"sensors", description:"قراءات غير متوقعة من MAF.", causes:["MAF متسخ","تسريب هواء"], solutions:["تنظيف MAF","فحص خراطيم السحب"]},
{code:"P0101", title:"إشارة MAF غير طبيعية", brands:["all"], system:"sensors", description:"اشارات ناقصة أو زائدة من MAF.", causes:["حساس تالف","توصلات رديئة"], solutions:["استبدال/تنظيف MAF","فحص التوصيلات"]},
{code:"P0102", title:"إشارة منخفضة من MAF", brands:["all"], system:"sensors", description:"قراءة منخفضة لتدفق الهواء.", causes:["تسريب هواء","MAF خربان"], solutions:["فحص تسريبات الهواء","استبدال MAF"]},
{code:"P0103", title:"إشارة مرتفعة من MAF", brands:["all"], system:"sensors", description:"قراءة مرتفعة لتدفق الهواء.", causes:["MAF ملوث","دخول هواء زائد"], solutions:["تنظيف MAF","فحص مسارات الهواء"]},
{code:"P0110", title:"خطأ في حساس درجة حرارة الهواء", brands:["all"], system:"sensors", description:"إشارة غير منطقية من حساس الحرارة.", causes:["حساس IAT معطل","توصيلات"], solutions:["استبدال الحساس","فحص الأسلاك"]},
{code:"P0113", title:"IAT إشارة عالية", brands:["all"], system:"sensors", description:"قراءة حرارة عالية مفاجئة.", causes:["حساس تالف","دوائر مفتوحة"], solutions:["فحص الحساس","إصلاح الدائرة"]},
{code:"P0128", title:"حرارة التبريد لم تصل لدرجة التشغيل", brands:["all"], system:"cooling", description:"الثيرموستات ربما عالق.", causes:["ثرموستات مفتوح دائماً","نقص سائل تبريد"], solutions:["استبدال الثرموستات","تعبئة سائل التبريد"]},
{code:"P0135", title:"دائرة سخان حساس O2", brands:["all"], system:"sensors", description:"سخان حساس الأوكسجين لا يعمل.", causes:["فيوز/ريلاي السخان","حساس O2 تالف"], solutions:["فحص الفيوز","استبدال حساس O2"]},
{code:"P0155", title:"دائرة سخان حساس O2 بنك2", brands:["all"], system:"sensors", description:"مشكلة في سخان حساس O2 الجانب الثاني.", causes:["فشل السخان","دوائر"], solutions:["فحص/استبدال الحساس","فحص الدائرة"]},
{code:"P0171", title:"خليط فقير - بنك 1", brands:["all"], system:"fuel", description:"خليط هواء/وقود فقير.", causes:["تسريب هواء","MAF متسخ"], solutions:["فحص خراطيم التسريب","تنظيف MAF"]},
{code:"P0172", title:"خليط غني - بنك 1", brands:["all"], system:"fuel", description:"خليط غني بالوقود.", causes:["بخاخات تتسرب","حساس O2 معطوب"], solutions:["فحص البخاخات","استبدال حساس O2"]},
{code:"P0180", title:"دائرة حساس ضغط وقود الوقود", brands:["all"], system:"fuel", description:"خطأ في قياس ضغط الوقود.", causes:["حساس الضغط تالف","مشكلة فنية في المضخة"], solutions:["فحص الحساس","قياس ضغط الوقود"]},
{code:"P0200", title:"دائرة حقن الوقود - خطأ عام", brands:["all"], system:"fuel", description:"خلل في دائرة حقن الوقود.", causes:["بخاخات","توصيلات"], solutions:["فحص البخاخات","فحص الأسلاك"]},
{code:"P0201", title:"دائرة بخاخ اسطوانة 1", brands:["all"], system:"fuel", description:"خلل في دائرة بخاخ رقم 1.", causes:["بخاخ تالف","توصيلات"], solutions:["فحص البخاخ","استبدال إن لزم"]},
{code:"P0202", title:"دائرة بخاخ اسطوانة 2", brands:["all"], system:"fuel", description:"خلل في دائرة بخاخ رقم 2.", causes:["بخاخ تالف","توصيلات"], solutions:["فحص البخاخ","استبدال"]},
{code:"P0203", title:"دائرة بخاخ اسطوانة 3", brands:["all"], system:"fuel", description:"...", causes:["..."], solutions:["..."]},
{code:"P0217", title:"درجة حرارة المحرك مرتفعة جداً", brands:["all"], system:"engine", description:"المحرك يعمل بحرارة مرتفعة.", causes:["نقص سائل تبريد","ثرموستات عالق"], solutions:["فحص سائل التبريد","استبدال الثرموستات"]},
{code:"P0261", title:"تسلسل الحقن اسطوانة 1", brands:["all"], system:"fuel", description:"خلل ترتيب الحقن.", causes:["بخاخ/أسلاك"], solutions:["فحص البخاخ/الأسلاك"]},
{code:"P0300", title:"خلل احتراق عشوائي (Misfire)", brands:["all"], system:"engine", description:"احتراق غير منتظم يسبب اهتزاز.", causes:["شمعات تالفة","بخاخات متسخة"], solutions:["تبديل الشمعات","تنظيف البخاخات"]},
{code:"P0301", title:"خلل احتراق اسطوانة 1", brands:["all"], system:"engine", description:"احتراق اسطوانة 1 غير منتظم.", causes:["شمع/كويل رقم1"], solutions:["فحص/استبدال الشمع والكويل"]},
{code:"P0302", title:"خلل احتراق اسطوانة 2", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P0303", title:"خلل احتراق اسطوانة 3", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P0316", title:"احتراق متأخر بعد التشغيل", brands:["all"], system:"engine", description:"احتراق متأخر عند بداية التشغيل.", causes:["حساسات خاطئة","خلل وقود"], solutions:["فحص الحساسات","فحص نظام الوقود"]},
{code:"P0325", title:"حساس النوك (Knock) - دائرة", brands:["all"], system:"engine", description:"إشارة حساس النوك غير صحيحة.", causes:["حساس تالف","توصيلات"], solutions:["استبدال الحساس","فحص التوصيلات"]},
{code:"P0335", title:"حساس الكرنك - فقدان الإشارة", brands:["all"], system:"engine", description:"فقدان إشارة حساس عمود الكرنك.", causes:["حساس كرنك تالف","أسلاك"], solutions:["استبدال حساس الكرنك","فحص الضفيرة"]},
{code:"P0340", title:"حساس كام شفت - إشارة", brands:["all"], system:"engine", description:"خلل إشارة حساس عمود الكامات.", causes:["حساس كام معطوب","توصيلات"], solutions:["استبدال الحساس","فحص التوصيلات"]},
{code:"P0351", title:"دائرة ملف إشعال اسطوانة 1", brands:["all"], system:"ignition", description:"خلل في دائرة كويل اسطوانة 1.", causes:["كويل تالف","توصيلات"], solutions:["استبدال الكويل","فحص الأسلاك"]},
{code:"P0420", title:"كفاءة المحول الحفاز منخفضة", brands:["all"], system:"emissions", description:"انخفاض كفاءة المحول (Catalytic).", causes:["محول تالف","حساس O2"], solutions:["فحص حساس O2","فحص/استبدال المحول"]},
{code:"P0421", title:"كفاءة المحول منخفضة - بنك1", brands:["all"], system:"emissions", description:"حالة كفاءة المحول لبنك 1.", causes:["محول متعب","حساسات"], solutions:["فحص المحول","تغيير الحساسات"]},
{code:"P0430", title:"كفاءة المحول منخفضة - بنك2", brands:["all"], system:"emissions", description:"...", causes:["..."], solutions:["..."]},
{code:"P0440", title:"خلل بنظام EVAP", brands:["all"], system:"evap", description:"خطأ في نظام تبخر الوقود.", causes:["خراطيم متسربة","صمام EVAP"], solutions:["فحص الخراطيم","فحص/استبدال الصمام"]},
{code:"P0441", title:"تدفق غير صحيح EVAP", brands:["all"], system:"evap", description:"إشارة تدفق خاطئة في نظام EVAP.", causes:["صمام معطوب","خراطيم"], solutions:["فحص الصمامات","استبدال الخراطيم"]},
{code:"P0442", title:"تسريب صغير EVAP", brands:["all"], system:"evap", description:"تسريب طفيف في نظام EVAP.", causes:["غطاء بنزين غير محكم","خراطيم مشققة"], solutions:["تأكد من إحكام الغطاء","استبدال الخراطيم"]},
{code:"P0455", title:"تسريب كبير EVAP", brands:["all"], system:"evap", description:"تسريب واضح في نظام EVAP.", causes:["غطاء بنزين مكسور","خراطيم ممزقة"], solutions:["استبدال الغطاء","فحص الخراطيم"]},
{code:"P0500", title:"خلل حساس سرعة المركبة VSS", brands:["all"], system:"electrical", description:"قراءة خاطئة من حساس السرعة.", causes:["حساس VSS تالف","توصيلات"], solutions:["فحص الحساس","استبدال إن لزم"]},
{code:"P0505", title:"خلل تحكم دوران الخمول", brands:["all"], system:"engine", description:"ارتفاع/هبوط غير طبيعي لدوران الخمول.", causes:["صمام الخانق متسخ","حساسات"], solutions:["تنظيف الخانق","فحص الحساسات"]},
{code:"P0562", title:"جهد النظام منخفض", brands:["all"], system:"electrical", description:"انخفاض جهد كهربائي (بطارية/مولد).", causes:["بطارية ضعيفة","مولد معطل"], solutions:["فحص البطارية","فحص المولد"]},
{code:"P0606", title:"خلل وحدة التحكم ECM", brands:["all"], system:"electrical", description:"خطأ في أداء وحدة التحكم.", causes:["ECU معطوب","برمجة خاطئة"], solutions:["إعادة برمجة","استبدال وحدة التحكم"]},
{code:"P0627", title:"دائرة تحكم المولد", brands:["all"], system:"electrical", description:"خلل في منظم المولد أو دائرته.", causes:["منظم فولتاج تالف","أسلاك"], solutions:["فحص المنظم","فحص التوصيلات"]},
{code:"P0700", title:"خطأ عام في ناقل الحركة", brands:["all"], system:"transmission", description:"ظهور خطأ خاص بالناقلة.", causes:["أخطاء TCM","حساسات ناقل الحركة"], solutions:["قراءة أكواد ناقل الحركة","فحص وحدة النقل"]},
{code:"P0715", title:"حساس حرارة ناقل الحركة", brands:["all"], system:"transmission", description:"قراءة حرارة ناقلة غير منطقية.", causes:["حساس تالف","توصيلات"], solutions:["فحص الحساس","استبدال إن لزم"]},
{code:"P0730", title:"نسبة التروس غير صحيحة", brands:["all"], system:"transmission", description:"نسبة التروس الفعلية لا تطابق المتوقعة.", causes:["حساسات ناقل الحركة","مشكلة ميكانيكية"], solutions:["فحص الحساسات","فحص ميكانيكي"]},
{code:"P0750", title:"دائرة صمام تحكم التحول", brands:["all"], system:"transmission", description:"خلل في دائرة صمامات النقل (Shift Solenoid).", causes:["صمام معطوب","توصيلات"], solutions:["فحص/استبدال الصمام","فحص الأسلاك"]},
{code:"P0755", title:"دائرة صمام التحول 2", brands:["all"], system:"transmission", description:"...", causes:["..."], solutions:["..."]},
{code:"P0785", title:"خطأ توقيت تبديل التروس", brands:["all"], system:"transmission", description:"توقيت تغير التروس غير صحيح.", causes:["صمامات","حساسات"], solutions:["فحص الصمامات","فحص الحساسات"]},
{code:"P1106", title:"إشارة تدفق الوقود/هواء — بعض الأنظمة", brands:["all"], system:"fuel", description:"قيمة غير متوقعة في حساسات الوقود/هواء.", causes:["حساس متسخ","خلل كهربائي"], solutions:["تنظيف الحساس","فحص الدائرة"]},
{code:"P1128", title:"تنظيم خليط الوقود — بعض الأنظمة", brands:["all"], system:"fuel", description:"تعديل غير طبيعي لخليط الوقود.", causes:["حساسات","تحكم ECU"], solutions:["فحص الحساسات","إعادة برمجة ECU"]},
{code:"P1186", title:"خليط خاص لموديلات معينة", brands:["Toyota"], system:"fuel", description:"رمز خاص ببعض موديلات تويوتا.", causes:["تصميم المصنع","حساس معين"], solutions:["مراجعة دليل المصنع","فحص الحساسات"]},
{code:"P1299", title:"خطأ عام بنظام الوقود", brands:["all"], system:"fuel", description:"خلل عام مرتبط بنظام الوقود.", causes:["مضخة","حساسات"], solutions:["فحص النظام كاملاً"]},
{code:"P1504", title:"تحكم سرعة الخمول — خلل", brands:["all"], system:"engine", description:"خلل في آلية التحكم بخمول المحرك.", causes:["خنق/صمام الخانق","حساسات"], solutions:["تنظيف/فحص الصمام","فحص الحساسات"]},
{code:"P1604", title:"خطأ بدء التشغيل/برمجة", brands:["all"], system:"electrical", description:"خطأ في بداية التشغيل أو برمجة.", causes:["ECU","برمجة"], solutions:["إعادة برمجة","فحص ECU"]},
{code:"P1700", title:"خطأ عام في ناقل الحركة", brands:["all"], system:"transmission", description:"...", causes:["..."], solutions:["..."]},
{code:"P2002", title:"فلتر جسيمات الديزل (DPF) مسدود", brands:["diesel"], system:"emissions", description:"انسداد DPF بتراكم السخام.", causes:["تراكم جسيمات"], solutions:["إعادة تنظيف DPF","استبدال إن لزم"]},
{code:"P2106", title:"إشارة دواسة البنزين/E-throttle", brands:["all"], system:"electrical", description:"خلل في إشارة دواسة البنزين.", causes:["حساس الدواسة","توصيلات"], solutions:["فحص الحساس","استبدال إن لزم"]},
{code:"P2111", title:"خانة الخانق عالقة أو إشارة خاطئة", brands:["all"], system:"engine", description:"إشارة تفيد بأن الخانق عالق.", causes:["اتساخ الخانق","حساس/محرك الخانق"], solutions:["تنظيف جسم الخانق","فحص واستبدال الحساس"]},
{code:"P2195", title:"خليط غني/فقير — تناقض", brands:["all"], system:"fuel", description:"تناقض في قراءة نسبة الوقود.", causes:["حساس O2","تسريب هواء"], solutions:["فحص حساس O2","فحص تسربات الهواء"]},
{code:"U0100", title:"فقدان الاتصال مع وحدة ECM", brands:["all"], system:"electrical", description:"انقطاع اتصال وحدة التحكم الرئيسية.", causes:["شبكة CAN","ECU"], solutions:["فحص شبكة CAN","فحص ECU"]},
{code:"U0121", title:"فقدان اتصال مع ABS", brands:["all"], system:"electrical", description:"انقطاع اتصال وحدة مضادة القفل.", causes:["شبكة","وحدة ABS"], solutions:["فحص الوصلات","فحص وحدة ABS"]},
{code:"B0020", title:"خطأ في نظام الوسائد الهوائية", brands:["all"], system:"safety", description:"خلل في دائرة الوسائد.", causes:["حساس وسائد تالف","توصيلات"], solutions:["فحص الدوائر","استبدال الحساس"]},
{code:"C0035", title:"حساس زاوية التوجيه — خلل", brands:["all"], system:"safety", description:"خطأ في حساس التوجيه.", causes:["توصيلات","حساس"], solutions:["فحص الحساس","فحص الأسلاك"]},
{code:"P0261", title:"خلل تسلسل حقن — اسطوانة 1", brands:["all"], system:"fuel", description:"", causes:[""], solutions:[""]},
{code:"P0262", title:"خلل تسلسل حقن — اسطوانة 2", brands:["all"], system:"fuel", description:"", causes:[""], solutions:[""]},
{code:"P0304", title:"خلل احتراق اسطوانة 4", brands:["all"], system:"engine", description:"", causes:[""], solutions:[""]},
{code:"P0305", title:"خلل احتراق اسطوانة 5", brands:["all"], system:"engine", description:"", causes:[""], solutions:[""]},
{code:"P0306", title:"خلل احتراق اسطوانة 6", brands:["all"], system:"engine", description:"", causes:[""], solutions:[""]},
{code:"P0402", title:"تدفق زائد EGR", brands:["all"], system:"emissions", description:"تدفق عادم زائد عبر EGR.", causes:["صمام EGR عالق","توصيلات"], solutions:["تنظيف الصمام","فحص الأنابيب"]},
{code:"P0456", title:"تسريب صغير جدًا في EVAP", brands:["all"], system:"evap", description:"تسريب صغير جداً.", causes:["غطاء البنزين غير محكم","خراطيم"], solutions:["إحكام الغطاء","استبدال الخراطيم"]},
{code:"P0506", title:"دوران الخمول منخفض جدًا", brands:["all"], system:"engine", description:"دوران الخمول أقل من المتوقع.", causes:["تسريب هواء","خلل الخانق"], solutions:["فحص الخراطيم","تنظيف الخانق"]},
{code:"P0563", title:"جهد النظام العالي جدًا", brands:["all"], system:"electrical", description:"جهاز شكاوى من زيادة الفولت.", causes:["المنظم معطوب","دوائر"], solutions:["فحص المنظم","فحص النظام الكهربائي"]},
{code:"P0600", title:"خطأ في التواصل مع وحدة التحكم", brands:["all"], system:"electrical", description:"انقطاع أو تشويش في التواصل.", causes:["أسلاك","ECU"], solutions:["فحص الأسلاك","فحص الوحدات"]},
{code:"P0601", title:"خطأ ذاكرة ECU", brands:["all"], system:"electrical", description:"فشل في ذاكرة وحدة التحكم.", causes:["برمجة خاطئة","ECU متعب"], solutions:["إعادة برمجة","استبدال ECU"]},
{code:"P0606", title:"أداء وحدة التحكم ECM", brands:["all"], system:"electrical", description:"تدهور أداء ECM.", causes:["ECU تالف","برمجة"], solutions:["استبدال/إعادة برمجة ECU"]},
{code:"P0620", title:"خلل دائرة دينمو/مولد", brands:["all"], system:"electrical", description:"خلل في دائرة الدينمو.", causes:["منظم فولتاج","أسلاك"], solutions:["فحص المولد","فحص المنظم"]},
{code:"P0706", title:"إشارة حساسات ناقل الحركة", brands:["all"], system:"transmission", description:"إشارة خاطئة من حساس ناقل الحركة.", causes:["حساس تالف","توصيلات"], solutions:["استبدال الحساس","فحص التوصيلات"]},
{code:"P0720", title:"حساس سرعة الناقل/مخرجات السرعة", brands:["all"], system:"transmission", description:"قراءة غير صحيحة لحركة ناقل الحركة.", causes:["حساس السرعة","توصيلات"], solutions:["فحص الحساس","استبدال إن لزم"]},
{code:"P0731", title:"نسبة التروس غير صحيحة — 1", brands:["all"], system:"transmission", description:"نسبة ترس 1 غير صحيحة.", causes:["حساسات","ميكانيك"], solutions:["فحص الحساس","فحص الميكانيك"]},
{code:"P0756", title:"صمام التحول 3 دائرة", brands:["all"], system:"transmission", description:"خلل في دائرة صمام النقل 3.", causes:["صمام","أسلاك"], solutions:["فحص/استبدال الصمام","فحص الأسلاك"]},
{code:"P0796", title:"صمامات التحكم في التبديل — خطأ", brands:["all"], system:"transmission", description:"...", causes:["..."], solutions:["..."]},
{code:"P1101", title:"تعديل تدفق الهواء/وقود — بعض الأنظمة", brands:["all"], system:"fuel", description:"...", causes:["..."], solutions:["..."]},
{code:"P1121", title:"حساس خليط محرك — إشارة", brands:["all"], system:"fuel", description:"...", causes:["..."], solutions:["..."]},
{code:"P1135", title:"حساس O2 دائرة — بنك1", brands:["all"], system:"sensors", description:"...", causes:["..."], solutions:["..."]},
{code:"P1155", title:"إشارة O2 عالية — بنك1", brands:["all"], system:"sensors", description:"...", causes:["..."], solutions:["..."]},
{code:"P1166", title:"خلل تحكم وقود — بعض الموديلات", brands:["all"], system:"fuel", description:"...", causes:["..."], solutions:["..."]},
{code:"P1298", title:"خلل في نظام الوقود — مثال", brands:["all"], system:"fuel", description:"...", causes:["..."], solutions:["..."]},
{code:"P1345", title:"تزامن الكامات — خطأ", brands:["all"], system:"engine", description:"اختلال توقيت عمود الكامات.", causes:["تذبذب حزام التوقيت","حساسات"], solutions:["فحص الحزام","فحص الحساسات"]},
{code:"P1456", title:"تسريب نظام EVAP — تعليمات", brands:["all"], system:"evap", description:"...", causes:["..."], solutions:["..."]},
{code:"P1507", title:"تحكم سرعة الخمول — تعديل", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P1600", title:"خطأ بدء التشغيل/أمن", brands:["all"], system:"electrical", description:"...", causes:["..."], solutions:["..."]},
{code:"P1706", title:"تنبيه ناقل الحركة — عام", brands:["all"], system:"transmission", description:"...", causes:["..."], solutions:["..."]},
{code:"P2004", title:"خلل نظام الهواء/عادم", brands:["all"], system:"emissions", description:"...", causes:["..."], solutions:["..."]},
{code:"P2100", title:"دائرة تحكم دواسة البنزين", brands:["all"], system:"electrical", description:"...", causes:["..."], solutions:["..."]},
{code:"P2119", title:"إشارة خاطئة لبوابة الخانق", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P2121", title:"حساس دواسة البنزين — إشارة", brands:["all"], system:"electrical", description:"...", causes:["..."], solutions:["..."]},
{code:"P2176", title:"خليط خلل — تشغيل بارد", brands:["all"], system:"fuel", description:"...", causes:["..."], solutions:["..."]},
{code:"P2196", title:"خليط بنك متعدد — خطأ", brands:["all"], system:"fuel", description:"...", causes:["..."], solutions:["..."]},
{code:"P2197", title:"خلل خليط بنك1", brands:["all"], system:"fuel", description:"...", causes:["..."], solutions:["..."]},
{code:"P2198", title:"خلل خليط بنك2", brands:["all"], system:"fuel", description:"...", causes:["..."], solutions:["..."]},
{code:"P2200", title:"حساس نسبة الأكاسيد — خلل", brands:["all"], system:"sensors", description:"...", causes:["..."], solutions:["..."]},
{code:"P2299", title:"ضغط وقود زائد/ناقص — خطأ", brands:["all"], system:"fuel", description:"...", causes:["..."], solutions:["..."]},
{code:"P2401", title:"حساس تسرب العادم — EGR", brands:["all"], system:"emissions", description:"...", causes:["..."], solutions:["..."]},
{code:"P2500", title:"حساس نظام الحقن — خلل", brands:["all"], system:"fuel", description:"...", causes:["..."], solutions:["..."]},
{code:"P2600", title:"دائرة طاقة وحدة تحكم — خطأ", brands:["all"], system:"electrical", description:"...", causes:["..."], solutions:["..."]},
{code:"P2603", title:"دائرة طاقة ECM — خلل", brands:["all"], system:"electrical", description:"...", causes:["..."], solutions:["..."]},
{code:"P2610", title:"دائرة حساسية وحدة التحكم", brands:["all"], system:"electrical", description:"...", causes:["..."], solutions:["..."]},
{code:"P2628", title:"حساس دائرة مولد الطاقة", brands:["all"], system:"electrical", description:"...", causes:["..."], solutions:["..."]},
{code:"P2630", title:"حساس دائرة السخانات", brands:["all"], system:"electrical", description:"...", causes:["..."], solutions:["..."]},
{code:"P2700", title:"خلل في صندوق التروس — خطأ عام", brands:["all"], system:"transmission", description:"...", causes:["..."], solutions:["..."]},
{code:"P2706", title:"حساس ناقل الحركة — دائرة", brands:["all"], system:"transmission", description:"...", causes:["..."], solutions:["..."]},
{code:"P2730", title:"دائرة التحكم بصمام التحول — 5", brands:["all"], system:"transmission", description:"...", causes:["..."], solutions:["..."]},
{code:"P2801", title:"حساس ضغط ناقل الحركة", brands:["all"], system:"transmission", description:"...", causes:["..."], solutions:["..."]},
{code:"P3000", title:"رمز احتياطي — مصمم للتوسيع", brands:["all"], system:"engine", description:"مساحة مخصصة لإدخال رموز إضافية", causes:["..."], solutions:["..."]},
{code:"P3001", title:"رمز احتياطي 1", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3002", title:"رمز احتياطي 2", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3003", title:"رمز احتياطي 3", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3004", title:"رمز احتياطي 4", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3005", title:"رمز احتياطي 5", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3006", title:"رمز احتياطي 6", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3100", title:"رمز نمطي للتوسيع", brands:["all"], system:"engine", description:"مساحة إضافية", causes:["..."], solutions:["..."]},
{code:"P3101", title:"رمز توسعة", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3102", title:"رمز توسعة 2", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3103", title:"رمز توسعة 3", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3104", title:"رمز توسعة 4", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3105", title:"رمز توسعة 5", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3106", title:"رمز توسعة 6", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3107", title:"رمز توسعة 7", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3108", title:"رمز توسعة 8", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3109", title:"رمز توسعة 9", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3110", title:"رمز توسعة 10", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3111", title:"رمز توسعة 11", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3112", title:"رمز توسعة 12", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3113", title:"رمز توسعة 13", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3114", title:"رمز توسعة 14", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3115", title:"رمز توسعة 15", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3116", title:"رمز توسعة 16", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3117", title:"رمز توسعة 17", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3118", title:"رمز توسعة 18", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3119", title:"رمز توسعة 19", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3120", title:"رمز توسعة 20", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3121", title:"رمز توسعة 21", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3122", title:"رمز توسعة 22", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3123", title:"رمز توسعة 23", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3124", title:"رمز توسعة 24", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3125", title:"رمز توسعة 25", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3126", title:"رمز توسعة 26", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3127", title:"رمز توسعة 27", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3128", title:"رمز توسعة 28", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3129", title:"رمز توسعة 29", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3130", title:"رمز توسعة 30", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3131", title:"رمز توسعة 31", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3132", title:"رمز توسعة 32", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3133", title:"رمز توسعة 33", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3134", title:"رمز توسعة 34", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3135", title:"رمز توسعة 35", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3136", title:"رمز توسعة 36", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3137", title:"رمز توسعة 37", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3138", title:"رمز توسعة 38", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3139", title:"رمز توسعة 39", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3140", title:"رمز توسعة 40", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3141", title:"رمز توسعة 41", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3142", title:"رمز توسعة 42", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3143", title:"رمز توسعة 43", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3144", title:"رمز توسعة 44", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3145", title:"رمز توسعة 45", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3146", title:"رمز توسعة 46", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3147", title:"رمز توسعة 47", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3148", title:"رمز توسعة 48", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3149", title:"رمز توسعة 49", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3150", title:"رمز توسعة 50", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3151", title:"رمز توسعة 51", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3152", title:"رمز توسعة 52", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3153", title:"رمز توسعة 53", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3154", title:"رمز توسعة 54", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3155", title:"رمز توسعة 55", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3156", title:"رمز توسعة 56", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3157", title:"رمز توسعة 57", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3158", title:"رمز توسعة 58", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3159", title:"رمز توسعة 59", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3160", title:"رمز توسعة 60", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3161", title:"رمز توسعة 61", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3162", title:"رمز توسعة 62", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3163", title:"رمز توسعة 63", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3164", title:"رمز توسعة 64", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3165", title:"رمز توسعة 65", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3166", title:"رمز توسعة 66", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3167", title:"رمز توسعة 67", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3168", title:"رمز توسعة 68", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3169", title:"رمز توسعة 69", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3170", title:"رمز توسعة 70", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3171", title:"رمز توسعة 71", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3172", title:"رمز توسعة 72", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3173", title:"رمز توسعة 73", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3174", title:"رمز توسعة 74", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3175", title:"رمز توسعة 75", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3176", title:"رمز توسعة 76", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3177", title:"رمز توسعة 77", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3178", title:"رمز توسعة 78", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3179", title:"رمز توسعة 79", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3180", title:"رمز توسعة 80", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3181", title:"رمز توسعة 81", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3182", title:"رمز توسعة 82", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3183", title:"رمز توسعة 83", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3184", title:"رمز توسعة 84", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3185", title:"رمز توسعة 85", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3186", title:"رمز توسعة 86", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3187", title:"رمز توسعة 87", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3188", title:"رمز توسعة 88", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3189", title:"رمز توسعة 89", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3190", title:"رمز توسعة 90", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3191", title:"رمز توسعة 91", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3192", title:"رمز توسعة 92", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3193", title:"رمز توسعة 93", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3194", title:"رمز توسعة 94", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3195", title:"رمز توسعة 95", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3196", title:"رمز توسعة 96", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3197", title:"رمز توسعة 97", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3198", title:"رمز توسعة 98", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3199", title:"رمز توسعة 99", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3200", title:"رمز توسعة 100", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3201", title:"رمز توسعة 101", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3202", title:"رمز توسعة 102", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3203", title:"رمز توسعة 103", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3204", title:"رمز توسعة 104", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3205", title:"رمز توسعة 105", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3206", title:"رمز توسعة 106", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3207", title:"رمز توسعة 107", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3208", title:"رمز توسعة 108", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3209", title:"رمز توسعة 109", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3210", title:"رمز توسعة 110", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3211", title:"رمز توسعة 111", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3212", title:"رمز توسعة 112", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3213", title:"رمز توسعة 113", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3214", title:"رمز توسعة 114", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3215", title:"رمز توسعة 115", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3216", title:"رمز توسعة 116", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3217", title:"رمز توسعة 117", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3218", title:"رمز توسعة 118", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3219", title:"رمز توسعة 119", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]},
{code:"P3220", title:"رمز توسعة 120", brands:["all"], system:"engine", description:"...", causes:["..."], solutions:["..."]}
]; // نهاية BUILT_IN_DB

/* ---------- نماذج الموديلات (مختصرة) ---------- */
const MODELS = {
  "all":["عام — غير محدد"],
  "Renault":["Clio","Symbol","Megane","Kangoo","Captur"],
  "Peugeot":["206","207","208","301","308"],
  "Chery":["Tiggo 3","Tiggo 7"],
  "Fiat":["Punto","500"],
  "Hyundai":["Accent","i10","i20","Elantra"],
  "Volkswagen":["Golf","Polo"],
  "BMW":["3 Series","5 Series"],
  "Other":["موديل آخر"]
};

/* ---------- وظائف المساعد ---------- */
function fillModels(brand){ const sel=document.getElementById('model'); sel.innerHTML=''; (MODELS[brand]||MODELS['Other']).forEach(m=>{ const o=document.createElement('option'); o.value=m; o.textContent=m; sel.appendChild(o); }); }
fillModels('all');
document.getElementById('brand').addEventListener('change', e=> fillModels(e.target.value));

let IMPORTED_DB = null;
function getDB(){ return IMPORTED_DB || BUILT_IN_DB; }

/* ---------- Avatar handling (session storage) ---------- */
document.getElementById('avatarFile').addEventListener('change', function(e){
  const f = e.target.files && e.target.files[0];
  if(!f) return;
  const r = new FileReader();
  r.onload = function(){ const data = r.result; const box = document.getElementById('avatarBox'); box.innerHTML=''; const img=document.createElement('img'); img.src=data; img.style.width='100%'; img.style.height='100%'; img.style.objectFit='cover'; box.appendChild(img); try{ sessionStorage.setItem('dali_profile_image', data); }catch(err){} };
  r.readAsDataURL(f);
});
try{ const stored = sessionStorage.getItem('dali_profile_image'); if(stored){ const box=document.getElementById('avatarBox'); box.innerHTML=''; const img=document.createElement('img'); img.src=stored; img.style.width='100%'; img.style.height='100%'; img.style.objectFit='cover'; box.appendChild(img); } }catch(err){}

/* ---------- Open codes modal (search & select) ---------- */
document.getElementById('openCodesBtn').addEventListener('click', ()=> openCodesModal());

function openCodesModal(initial=''){
  const overlay = document.createElement('div'); overlay.className='modal-overlay';
  const modal = document.createElement('div'); modal.className='modal';
  const header = document.createElement('div'); header.style.display='flex'; header.style.justifyContent='space-between'; header.style.alignItems='center';
  const h = document.createElement('strong'); h.textContent='قائمة الأكواد (200+) — اختر رمزاً';
  const close = document.createElement('button'); close.className='btn btn-ghost'; close.textContent='إغلاق'; close.onclick = ()=> overlay.remove();
  header.appendChild(h); header.appendChild(close); modal.appendChild(header);

  const search = document.createElement('input'); search.placeholder='ابحث بالكود أو بالكلمة (مثال: P0300 أو محول)'; search.style.width='100%'; search.style.margin='10px 0'; search.style.padding='8px'; modal.appendChild(search);

  const sysRow = document.createElement('div'); sysRow.style.display='flex'; sysRow.style.gap='8px'; sysRow.style.marginBottom='8px';
  const sysSel = document.createElement('select'); ['all','engine','fuel','ignition','emissions','transmission','sensors','electrical','evap','safety'].forEach(s=>{ const o=document.createElement('option'); o.value=s; o.textContent=s==='all'?'كل الأنظمة':s; sysSel.appendChild(o); });
  sysRow.appendChild(sysSel); modal.appendChild(sysRow);

  const list = document.createElement('div'); modal.appendChild(list);

  function render(q=''){
    list.innerHTML=''; const db = getDB();
    const qq=(q||'').toLowerCase().trim(); const selSys = sysSel.value;
    const items = db.filter(it=>{ if(selSys!=='all' && (it.system||'')!==selSys) return false; if(!qq) return true; const hay = (it.code||'')+' '+(it.title||'')+' '+(it.description||'')+' '+(it.causes||[]).join(' '); return hay.toLowerCase().includes(qq); });
    if(items.length===0){ list.innerHTML='<div class="empty">لا توجد نتائج</div>'; return; }
    items.slice(0,1200).forEach(it=>{
      const row = document.createElement('div'); row.className='list-row';
      row.innerHTML = '<div style="display:flex;justify-content:space-between;align-items:center;"><div><strong>'+escapeHtml(it.code)+'</strong> <span style="color:var(--muted);margin-right:8px">'+escapeHtml(it.title)+'</span></div><div style="color:var(--muted)">'+((it.brands&&it.brands.length)? it.brands.join(' · '):'عام')+'</div></div>';
      row.onclick = ()=> { document.getElementById('codeInput').value = it.code || ''; overlay.remove(); };
      list.appendChild(row);
    });
  }

  search.addEventListener('input', e=> render(e.target.value));
  sysSel.addEventListener('change', ()=> render(search.value));
  render(initial);
  overlay.appendChild(modal); document.body.appendChild(overlay);
}

/* ---------- Analyze function (Arabic output) ---------- */
function analyze(){
  const brand=document.getElementById('brand').value || 'all';
  const model=document.getElementById('model').value || '';
  const year=document.getElementById('year').value || '';
  const code=(document.getElementById('codeInput').value||'').trim().toUpperCase();
  const desc=(document.getElementById('desc').value||'').trim();
  const sysFilter=document.getElementById('system').value || 'all';
  const out=document.getElementById('outputArea'); out.innerHTML=''; document.getElementById('metaInfo').textContent = `ماركة: ${brand} · موديل: ${model||'—'} · سنة: ${year||'—'} · كود: ${code||'—'}`;

  const db=getDB(); let results=[];

  if(code){
    const exact = db.filter(it => (it.code||'').toString().toUpperCase() === code);
    if(exact.length) results = results.concat(exact);
    else {
      const prefix = code.replace(/[^A-Z0-9]/g,'').toUpperCase();
      const alt = db.filter(it => ((it.code||'')+'').toUpperCase().includes(prefix));
      results = results.concat(alt);
    }
  }

  if(desc){
    const toks = desc.toLowerCase().split(/\s+/).filter(t=>t.length>2);
    const matched = db.filter(it=>{
      const hay = (it.title||'')+' '+(it.description||'')+' '+(it.causes||[]).join(' ')+' '+(it.solutions||[]).join(' ');
      const low = hay.toLowerCase();
      return toks.some(tok => low.includes(tok));
    });
    matched.forEach(m=> { if(!results.some(r=>r.code===m.code)) results.push(m); });
  }

  if(sysFilter!=='all') results = results.filter(r => (r.system||'') === sysFilter);

  if(brand && brand!=='all') results = results.filter(r => { if(!r.brands || r.brands.length===0) return true; return r.brands.includes('all') || r.brands.map(b=>b.toLowerCase()).includes(brand.toLowerCase()); });

  if(results.length===0){
    const q = (code || desc).toLowerCase();
    if(q){
      const fallback = db.filter(it => (((it.code||'')+' '+(it.title||'')+' '+(it.description||'')).toLowerCase().includes(q)));
      fallback.forEach(m=> { if(!results.some(r=>r.code===m.code)) results.push(m); });
    }
  }

  if(results.length===0){
    out.innerHTML = `<div class="empty"><div style="font-weight:700;margin-bottom:8px">لم نعثر على نتيجة مباشرة</div><div>جرّب كتابة الكود مثل <strong>P0300</strong> أو اضف وصف أو اضغط "اختر كود" لتصفح القائمة.</div></div>`;
    return;
  }

  results.forEach(item=>{
    const el=document.createElement('div'); el.className='fault';
    el.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div><div style="color:var(--muted);font-size:13px">الكود</div><div style="font-size:18px;font-weight:800">${escapeHtml(item.code)}</div></div>
        <div style="text-align:left"><div style="font-size:13px;color:var(--muted)">${(item.brands && item.brands.length)? item.brands.join(' · '):'عام'}</div><div style="font-weight:800;margin-top:6px">${escapeHtml(item.title)}</div></div>
      </div>
      <div style="margin-top:10px;color:var(--muted)">${escapeHtml(item.description||'')}</div>
      <div style="margin-top:10px"><strong>الأسباب المحتملة:</strong><ul>${(item.causes||[]).map(c=>`<li>${escapeHtml(c)}</li>`).join('')}</ul></div>
      <div style="margin-top:6px"><strong>الحلول الممكنة:</strong><ul>${(item.solutions||[]).map(s=>`<li>${escapeHtml(s)}</li>`).join('')}</ul></div>
    `;
    out.appendChild(el);
  });

  // تحليل تجميعي بالعربية
  const systems = Array.from(new Set(results.map(r=>r.system))).join(' · ') || 'متعددة';
  const codesList = Array.from(new Set(results.map(r=>r.code))).join(', ');
  const analysisLines = [];
  analysisLines.push(`تحليل عام: بناءً على المدخلات (ماركة: ${brand}, موديل: ${model||'غير محدد'}, سنة: ${year||'غير محددة'}) والأكواد/الوصف (${codesList})، الأنظمة المتأثرة: ${systems}.\n`);
  analysisLines.push(`إجراءات تحقق سريعة:\n1) افحص التوصيلات والفيوزات ومأخذ OBD.\n2) افحص الشمعات والكويلات والماف والبخاخات حسب الأعراض.\n3) نظف حساس MAF وحساسات O2 إن لزم، وراقب Live data قبل الاستبدال.\n4) فحص تسريبات الهواء وخراطيم العادم إن كانت المشاكل خليط/انبعاثات.\n5) لأخطاء ناقل الحركة: اقرأ أكواد TCM ثم تحقق ميكانيكياً.\n`);
  analysisLines.push(`ملاحظة: هذه إرشادات أولية — قد يتطلب الأمر فحصًا تقنيًا متقدماً (ضغط اسطوانات، فحص كهربائي) للتأكد من الحل النهائي.\n`);
  const analysisText = analysisLines.join('\n');

  const analysisEl = document.createElement('div'); analysisEl.className='analysis'; analysisEl.style.marginTop='12px';
  analysisEl.innerHTML = `<h4 style="margin:0 0 8px 0;">🔎 تحليل مفصّل (بالعربية)</h4><pre class="analysis">${escapeHtml(analysisText)}</pre>`;
  out.appendChild(analysisEl);
}

/* ---------- Buttons ---------- */
document.getElementById('analyzeBtn').addEventListener('click', analyze);
document.getElementById('resetBtn').addEventListener('click', ()=>{
  document.getElementById('brand').value='all'; fillModels('all'); document.getElementById('year').value=''; document.getElementById('codeInput').value=''; document.getElementById('desc').value=''; document.getElementById('outputArea').innerHTML = '<div class="empty"><div style="font-weight:700;margin-bottom:8px">لم يتم إجراء تشخيص بعد</div><div>أدخل الكود أو اضغط \"اختر كود\" ثم اضغط \"تشخيص الآن\".</div></div>'; document.getElementById('metaInfo').textContent = 'لم يتم إجراء تشخيص — اضغط \"تشخيص الآن\".'; });

document.getElementById('copyBtn').addEventListener('click', ()=>{
  const txt = document.getElementById('outputArea').innerText;
  navigator.clipboard?.writeText(txt).then(()=> alert('تم نسخ النص ✅')).catch(()=> alert('فشل النسخ — جرب متصفح أحدث'));
});

document.getElementById('downloadBtn').addEventListener('click', ()=>{
  const brand=document.getElementById('brand').value; const model=document.getElementById('model').value; const year=document.getElementById('year').value; const code=document.getElementById('codeInput').value; const desc=document.getElementById('desc').value;
  const resultsText = document.getElementById('outputArea').innerText;
  const payload = { brand, model, year, code, desc, resultsText, exportedAt:new Date().toISOString() };
  const blob = new Blob([JSON.stringify(payload,null,2)],{type:'application/json'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`dali_diag_${Date.now()}.json`; a.click(); URL.revokeObjectURL(url);
});

/* ---------- Import external JSON DB (for real full set) ---------- */
document.getElementById('importBtn').addEventListener('click', ()=> document.getElementById('importJson').click());
document.getElementById('importJson').addEventListener('change', async (e)=>{
  const f = e.target.files && e.target.files[0];
  if(!f) return;
  try{
    const txt = await f.text(); const json = JSON.parse(txt);
    if(!Array.isArray(json)) return alert('خطأ: الملف يجب أن يكون مصفوفة JSON.');
    IMPORTED_DB = json;
    alert('تم استيراد قاعدة البيانات الخارجية بنجاح — الآن سيتم استخدامها في البحث.');
  }catch(err){ alert('فشل استيراد JSON: ' + (err.message||err)); }
});

/* ---------- Utility ---------- */
function escapeHtml(s){ if(!s) return ''; return s.toString().replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }

</script>
</body>
</html>
